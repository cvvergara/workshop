<!DOCTYPE html>

<html lang="es" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5. Función SQL &#8212; Workshop - FOSS4G Auckland - Routing with pgRouting</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=5a695559" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css?v=226d88b4" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=fa3951f0" />
    <script src="../_static/documentation_options.js?v=82a836dc"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/translations.js?v=f85f4cfb"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="6. Routing using points" href="withPoints.html" />
    <link rel="prev" title="4. Enrutamiento de vehículos" href="vehicle.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="../index.html">
          Workshop FOSS4G Auckland</a>
        <span class="navbar-text pull-left"><b>3.1</b></span>

        <div class="nav-collapse">
          <ul class="nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://docs.pgrouting.org/latest/en/index.html">Documentation</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Chapters <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/introduction.html">1. Introducción</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/osgeolive.html">2. OSGeoLive Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/overview.html">3. Software and Data Overview</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data.html">1. Preparar Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="graphs.html">2. Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="pedestrian.html">3. Enrutamiento peatonal</a></li>
<li class="toctree-l1"><a class="reference internal" href="vehicle.html">4. Enrutamiento de vehículos</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. Función SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="withPoints.html">6. Routing using points</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/data.html">1. Datos para los Objetivos de Desarrollo Sostenible</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/introduction.html">2. Alcanzar los Objetivos de Desarrollo Sostenible con pgRouting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/sdg3-health.html">3. Buena salud y bienestar</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/sdg7-energy.html">4. Energía asequible y limpia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/sdg11-cities.html">5. Ciudades y comunidades sostenibles</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-9.html">1. Uso de Qgis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-10.html">2. Servidor WMS con GeoServer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-11.html">3. Interfaz de Ruteo Basada en OpenLayers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/chapter-12.html">4. Crear una topología de red</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/boost_dijkstra.html">1. Ejemplo de Boost Dijkstra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/hanoslav.html">2. Ejemplos del Internet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/wiki_example.html">3. Ejemplo de Wikipedia Dijkstra</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-2.html">1. Apéndice: Instalación</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-3.html">2. Apéndice: Herramienta de Importación osm2pgrouting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-4.html">3. Tutoriales en Video para Taller</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">5. Función SQL</a><ul>
<li><a class="reference internal" href="#the-function-requirements">5.1. The function requirements</a></li>
<li><a class="reference internal" href="#additional-information-handling">5.2. Manipulación de la información adicional</a><ul>
<li><a class="reference internal" href="#exercise-1-get-additional-information">5.2.1. Ejercicio 1: Obtener información adicional</a></li>
</ul>
</li>
<li><a class="reference internal" href="#geometry-handling">5.3. Manejo de geometría</a><ul>
<li><a class="reference internal" href="#exercise-2-route-geometry-human-readable">5.3.1. Ejercicio 2: Geometría de la ruta (legible para humanos)</a></li>
<li><a class="reference internal" href="#exercise-3-route-geometry-binary-format">5.3.2. Ejercicio 3: Geometría de ruta (formato binario)</a></li>
<li><a class="reference internal" href="#exercise-4-route-geometry-directionality">5.3.3. Ejercicio 4: Direccionalidad de la geometría de la ruta</a></li>
<li><a class="reference internal" href="#exercise-5-using-the-geometry">5.3.4. Ejercicio 5: Uso de la geometría</a></li>
<li><a class="reference internal" href="#exercise-6-using-the-function">5.3.5. Exercise 6: Using the function</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="vehicle.html" title="Previous Chapter: 4. Enrutamiento de vehículos"><span class="icon-chevron-left visible-tablet"></span><span class="hidden-sm hidden-tablet">&laquo; 4. Enrutamien...</span>
    </a>
  </li>
  <li>
    <a href="withPoints.html" title="Next Chapter: 6. Routing using points"><span class="icon-chevron-right visible-tablet"></span><span class="hidden-sm hidden-tablet">6. Routing us... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
      </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body span12 content" role="main">
      
  <section id="sql-function">
<h1><a class="toc-backref" href="#id17" role="doc-backlink"><span class="section-number">5. </span>Función SQL</a><a class="headerlink" href="#sql-function" title="Link to this heading">¶</a></h1>
<a class="reference internal image-reference" href="../_images/sql_route_names.png"><img alt="../_images/sql_route_names.png" class="align-center" src="../_images/sql_route_names.png" style="width: 373.0px; height: 218.75px;" />
</a>
<nav class="contents" id="chapter-contents">
<p class="topic-title">Contenido del Capítulo</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sql-function" id="id17">Función SQL</a></p>
<ul>
<li><p><a class="reference internal" href="#the-function-requirements" id="id18">The function requirements</a></p></li>
<li><p><a class="reference internal" href="#additional-information-handling" id="id19">Manipulación de la información adicional</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-1-get-additional-information" id="id20">Ejercicio 1: Obtener información adicional</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#geometry-handling" id="id21">Manejo de geometría</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-2-route-geometry-human-readable" id="id22">Ejercicio 2: Geometría de la ruta (legible para humanos)</a></p></li>
<li><p><a class="reference internal" href="#exercise-3-route-geometry-binary-format" id="id23">Ejercicio 3: Geometría de ruta (formato binario)</a></p></li>
<li><p><a class="reference internal" href="#exercise-4-route-geometry-directionality" id="id24">Ejercicio 4: Direccionalidad de la geometría de la ruta</a></p></li>
<li><p><a class="reference internal" href="#exercise-5-using-the-geometry" id="id25">Ejercicio 5: Uso de la geometría</a></p></li>
<li><p><a class="reference internal" href="#exercise-6-using-the-function" id="id26">Exercise 6: Using the function</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<p>Las funciones pgRouting proporcionan una interfaz de <cite>bajo nivel</cite>.</p>
<p>Al desarrollar para una aplicación de <cite>nivel superior</cite>, los requisitos deben estar representados en las consultas SQL. A medida que estas consultas SQL se vuelven más complejas, es conveniente almacenarlas en funciones o procedimientos almacenados de postgreSQL. Los procedimientos o funciones almacenados son una forma eficaz de envolver la lógica de la aplicación, en este caso, relacionada con la lógica y los requisitos de ruteo.</p>
<section id="the-function-requirements">
<h2><a class="toc-backref" href="#id18" role="doc-backlink"><span class="section-number">5.1. </span>The function requirements</a><a class="headerlink" href="#the-function-requirements" title="Link to this heading">¶</a></h2>
<p>The function will wrap <code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code>.</p>
<p>The function needs to work on any of the networks designed:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">taxi_net</span></code></p></li>
</ul>
<p>The function needs to return the following routing information:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">seq</span></code> - Un identificador único de las filas</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code> - El identificador del segmento</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> - El nombre del segmento</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">length</span></code> - La longitud del segmento</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seconds</span></code> - Cantidad de segundos para atravesar el segmento</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">azimuth</span></code> - El azimut del segmento</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">route_geom</span></code> - La geometría de la ruta</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">route_readable</span></code> - La geometría en forma legible para humanos.</p></li>
</ul>
<p class="rubric">Diseño de la función</p>
<p>La función <code class="docutils literal notranslate"><span class="pre">wrk_dijkstra</span></code> se creará con los siguientes parámetros de entrada y columnas de salida:</p>
<p class="rubric">Parámetros de entrada</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Tipo</p></th>
<th class="head"><p>Descripción</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">edges_subset</span></code></p></td>
<td><p>REGCLASS</p></td>
<td><p>La tabla/vista que se utilizará para procesar</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">source</span></code></p></td>
<td><p>BIGINT</p></td>
<td><p>The  identifier of the <cite>departure</cite> location.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">target</span></code></p></td>
<td><p>BIGINT</p></td>
<td><p>The  identifier of the <cite>destination</cite> location.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">columnas de salida</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Nombre</p></th>
<th class="head"><p>Tipo</p></th>
<th class="head"><p>Descripción</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">seq</span></code></p></td>
<td><p>INTEGER</p></td>
<td><p>Un único número para cada fila de resultados.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>BIGINT</p></td>
<td><p>El identificador de arista.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">name</span></code></p></td>
<td><p>TEXT</p></td>
<td><p>El nombre del segmento.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">seconds</span></code></p></td>
<td><p>FLOAT</p></td>
<td><p>El número de segundos que se tarda en atravesar el segmento.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">length</span></code></p></td>
<td><p>FLOAT</p></td>
<td><p>Longitud en metros del segmento.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">azimuth</span></code></p></td>
<td><p>FLOAT</p></td>
<td><p>El azimuth del segmento.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">route_readable</span></code></p></td>
<td><p>TEXT</p></td>
<td><p>La geometría en forma humanamente legible.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">route_geom</span></code></p></td>
<td><p>geometry</p></td>
<td><p>La geometría del segmento en la dirección correcta.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="additional-information-handling">
<h2><a class="toc-backref" href="#id19" role="doc-backlink"><span class="section-number">5.2. </span>Manipulación de la información adicional</a><a class="headerlink" href="#additional-information-handling" title="Link to this heading">¶</a></h2>
<p>Cuando la aplicación necesita información adicional, como el nombre de la calle, <code class="docutils literal notranslate"><span class="pre">JOIN</span></code> los resultados con otras tablas.</p>
<section id="exercise-1-get-additional-information">
<h3><a class="toc-backref" href="#id20" role="doc-backlink"><span class="section-number">5.2.1. </span>Ejercicio 1: Obtener información adicional</a><a class="headerlink" href="#exercise-1-get-additional-information" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/sql_route_names.png"><img alt="Ruta que muestra nombres" src="../_images/sql_route_names.png" style="width: 300pt;" />
</a>
<p class="rubric">Problema</p>
<ul class="simple">
<li><p>Desde Emily Place Reserve hasta Auckland University of Technology</p></li>
<li><p>Obtener la siguiente información:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">seq</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seconds</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">length</span></code></p></li>
</ul>
</li>
</ul>
<p class="rubric">Solución</p>
<ul class="simple">
<li><p>The function returns the columns asked. (line <strong>4</strong>)</p></li>
<li><p>Rename <code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code> results to application requirements names. (line
<strong>12</strong>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LEFT</span> <span class="pre">JOIN</span></code> the results with <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code> to get the additional
information. (line <strong>17</strong>)</p>
<ul>
<li><p>Tiene que ser <code class="docutils literal notranslate"><span class="pre">LEFT</span></code> porque hay una fila con <code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">=</span> <span class="pre">-1</span></code> que no existe en <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code></p></li>
</ul>
</li>
<li><p>Test from <a href="#id1"><span class="problematic" id="id2">|ch7_id_1|</span></a> to <a href="#id3"><span class="problematic" id="id4">|ch7_id_2|</span></a> on <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code>. (Last line)</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">-- DROP FUNCTION wrk_dijkstra(regclass, bigint, bigint);</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span>
<span class="hll"><span class="linenos"> 4</span><span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">edges_subset</span><span class="w"> </span><span class="n">REGCLASS</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
</span><span class="linenos"> 5</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="k">length</span><span class="w"> </span><span class="nb">FLOAT</span>
<span class="linenos"> 6</span><span class="p">)</span>
<span class="linenos"> 7</span><span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="k">AS</span>
<span class="linenos"> 8</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos"> 9</span><span class="k">SELECT</span>
<span class="linenos">10</span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">length</span>
<span class="linenos">11</span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="hll"><span class="linenos">12</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">seconds</span>
</span><span class="linenos">13</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstra</span><span class="p">(</span>
<span class="linenos">14</span><span class="w">    </span><span class="s1">&#39;SELECT * FROM &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">15</span><span class="w">    </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">)</span>
<span class="linenos">16</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">results</span>
<span class="hll"><span class="linenos">17</span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vehicle_net</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
</span><span class="linenos">18</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span>
<span class="linenos">19</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">20</span><span class="k">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="p">;</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="821977c3-9c6c-4565-b1a9-e9b352b39290" name="821977c3-9c6c-4565-b1a9-e9b352b39290" type="checkbox"><label class="sphinx_collapse__label" for="821977c3-9c6c-4565-b1a9-e9b352b39290"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">FUNCTION</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="geometry-handling">
<h2><a class="toc-backref" href="#id21" role="doc-backlink"><span class="section-number">5.3. </span>Manejo de geometría</a><a class="headerlink" href="#geometry-handling" title="Link to this heading">¶</a></h2>
<p>Desde el punto de vista de pgRouting, la geometría es parte de la información adicional, necesaria en los resultados para una aplicación. Por lo tanto <code class="docutils literal notranslate"><span class="pre">JOIN</span></code> los resultados con otras tablas que contienen la geometría y para su posterior procesamiento con funciones de PostGIS.</p>
<section id="exercise-2-route-geometry-human-readable">
<h3><a class="toc-backref" href="#id22" role="doc-backlink"><span class="section-number">5.3.1. </span>Ejercicio 2: Geometría de la ruta (legible para humanos)</a><a class="headerlink" href="#exercise-2-route-geometry-human-readable" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/sql_route_readable.png"><img alt="Desde |ch7_place_1| hasta |ch7_place_2|" src="../_images/sql_route_readable.png" style="width: 300pt;" />
</a>
<p class="rubric">Problema</p>
<p>Ruteo desde Emily Place Reserve hasta Auckland University of Technology</p>
<ul class="simple">
<li><p>Además del ejercicio anterior, obtener</p>
<ul>
<li><p>la geometría <code class="docutils literal notranslate"><span class="pre">geom</span></code> en forma legible por humanos denominado como <code class="docutils literal notranslate"><span class="pre">route_readable</span></code></p></li>
</ul>
</li>
</ul>
<p class="rubric">Solución</p>
<ul class="simple">
<li><p>The function returns <code class="docutils literal notranslate"><span class="pre">route_readable</span></code>. (line <strong>6</strong>)</p></li>
<li><p>The routing query named <code class="docutils literal notranslate"><span class="pre">results</span></code> in a WITH clause. (line <strong>11</strong>)</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">geom</span></code> processed with <code class="docutils literal notranslate"><span class="pre">ST_AsText</span></code> to get the human readable form.
(line <strong>19</strong>).</p></li>
<li><p>Test from <a href="#id5"><span class="problematic" id="id6">|ch7_id_1|</span></a> to <a href="#id7"><span class="problematic" id="id8">|ch7_id_2|</span></a> on <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code>. (Last line)</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">DROP</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="n">regclass</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">);</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">edges_subset</span><span class="w"> </span><span class="n">REGCLASS</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="k">length</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span>
<span class="hll"><span class="linenos"> 6</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_readable</span><span class="w"> </span><span class="nb">TEXT</span>
</span><span class="linenos"> 7</span><span class="p">)</span>
<span class="linenos"> 8</span><span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="k">AS</span>
<span class="linenos"> 9</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">10</span><span class="k">WITH</span>
<span class="hll"><span class="linenos">11</span><span class="n">results</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span class="linenos">12</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">seconds</span>
<span class="linenos">13</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstra</span><span class="p">(</span>
<span class="linenos">14</span><span class="w">    </span><span class="s1">&#39;SELECT * FROM &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">15</span><span class="w">    </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">)</span>
<span class="linenos">16</span><span class="p">)</span>
<span class="linenos">17</span><span class="k">SELECT</span>
<span class="linenos">18</span><span class="w">  </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">length</span><span class="p">,</span>
<span class="hll"><span class="linenos">19</span><span class="w">  </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
</span><span class="linenos">20</span><span class="k">FROM</span><span class="w"> </span><span class="n">results</span>
<span class="linenos">21</span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vehicle_net</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="linenos">22</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span>
<span class="linenos">23</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">24</span><span class="k">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="p">;</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">route_readable</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="d63912e0-9c16-4d94-aab9-0961b1ebac99" name="d63912e0-9c16-4d94-aab9-0961b1ebac99" type="checkbox"><label class="sphinx_collapse__label" for="d63912e0-9c16-4d94-aab9-0961b1ebac99"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DROP</span> <span class="n">FUNCTION</span>
<span class="n">CREATE</span> <span class="n">FUNCTION</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-3-route-geometry-binary-format">
<h3><a class="toc-backref" href="#id23" role="doc-backlink"><span class="section-number">5.3.2. </span>Ejercicio 3: Geometría de ruta (formato binario)</a><a class="headerlink" href="#exercise-3-route-geometry-binary-format" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/sql_route_geom.png"><img alt="Desde |ch7_place_1| hasta |ch7_place_2|" src="../_images/sql_route_geom.png" style="width: 300pt;" />
</a>
<p class="rubric">Problema</p>
<p>Ruteo desde Emily Place Reserve hasta Auckland University of Technology</p>
<ul class="simple">
<li><p>Además del ejercicio anterior, obtener</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">geom</span></code> en formato binario con el nombre <code class="docutils literal notranslate"><span class="pre">route_geom</span></code></p></li>
</ul>
</li>
</ul>
<p class="rubric">Solución</p>
<ul class="simple">
<li><p>The function returns <code class="docutils literal notranslate"><span class="pre">route_geom</span></code>. (line <strong>7</strong>)</p></li>
<li><p>The geometry <code class="docutils literal notranslate"><span class="pre">geom</span></code> of the segments (line <strong>21</strong>)</p></li>
<li><p>Test from <a href="#id9"><span class="problematic" id="id10">|ch7_id_1|</span></a> to <a href="#id11"><span class="problematic" id="id12">|ch7_id_2|</span></a> on <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code>. (Last line)</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">DROP</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="n">regclass</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">);</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">edges_subset</span><span class="w"> </span><span class="n">REGCLASS</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="k">length</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_readable</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="hll"><span class="linenos"> 7</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_geom</span><span class="w"> </span><span class="n">geometry</span>
</span><span class="linenos"> 8</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="k">AS</span>
<span class="linenos">10</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">11</span><span class="k">WITH</span>
<span class="linenos">12</span><span class="n">results</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="linenos">13</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">seconds</span>
<span class="linenos">14</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstra</span><span class="p">(</span>
<span class="linenos">15</span><span class="w">    </span><span class="s1">&#39;SELECT * FROM &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">16</span><span class="w">    </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">)</span>
<span class="linenos">17</span><span class="p">)</span>
<span class="linenos">18</span><span class="k">SELECT</span>
<span class="linenos">19</span><span class="w">  </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">length</span><span class="p">,</span>
<span class="linenos">20</span><span class="w">  </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">),</span>
<span class="hll"><span class="linenos">21</span><span class="w">  </span><span class="n">geom</span>
</span><span class="linenos">22</span><span class="k">FROM</span><span class="w"> </span><span class="n">results</span>
<span class="linenos">23</span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vehicle_net</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="linenos">24</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span>
<span class="linenos">25</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">26</span><span class="k">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="p">;</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">route_geom</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="28a5abde-68e2-4b23-b375-3ade289bb8e8" name="28a5abde-68e2-4b23-b375-3ade289bb8e8" type="checkbox"><label class="sphinx_collapse__label" for="28a5abde-68e2-4b23-b375-3ade289bb8e8"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DROP</span> <span class="n">FUNCTION</span>
<span class="n">CREATE</span> <span class="n">FUNCTION</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-4-route-geometry-directionality">
<h3><a class="toc-backref" href="#id24" role="doc-backlink"><span class="section-number">5.3.3. </span>Ejercicio 4: Direccionalidad de la geometría de la ruta</a><a class="headerlink" href="#exercise-4-route-geometry-directionality" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/sql_route_geom_detail.png"><img alt="Desde |ch7_place_1| hasta |ch7_place_2|" src="../_images/sql_route_geom_detail.png" style="width: 300pt;" />
</a>
<p>Visualmente, con la ruta mostrada con flechas, se puede ver que hay flechas que no coinciden con la direccionalidad de la ruta.</p>
<p>Para tener una direccionalidad correcta, el punto final de una geometría debe coincidir con el punto inicial de la geometría siguiente</p>
<ul class="simple">
<li><p>Inspeccionando el detalle de los resultados de <a class="reference internal" href="#exercise-2-route-geometry-human-readable">Ejercicio 2: Geometría de la ruta (legible para humanos)</a></p></li>
</ul>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="a5ace499-604d-4be8-af4e-af90a3a522dc" name="a5ace499-604d-4be8-af4e-af90a3a522dc" type="checkbox"><label class="sphinx_collapse__label" for="a5ace499-604d-4be8-af4e-af90a3a522dc"><i class="sphinx_collapse__icon"></i>Query: Rows where criteria is not met</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span>
<span class="n">results</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">route_geom</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">)</span>
<span class="p">),</span>
<span class="n">compare</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">lead</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">next_seq</span><span class="p">,</span>
<span class="w">  </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">ST_endPoint</span><span class="p">(</span><span class="n">route_geom</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_end</span><span class="p">,</span>
<span class="w">  </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">ST_startPoint</span><span class="p">(</span><span class="n">lead</span><span class="p">(</span><span class="n">route_geom</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">next_id_start</span>

<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">results</span>
<span class="w">  </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id_end</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">next_id_start</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p class="rubric">Problema</p>
<p>Ruteo desde Emily Place Reserve hasta Auckland University of Technology</p>
<ul class="simple">
<li><p>Para arreglar la direccionalidad de las geometrías del ejercicio anterior</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">geom</span></code> en forma legible por humanos nombrado como <code class="docutils literal notranslate"><span class="pre">route_readable</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geom</span></code> en formato binario con el nombre <code class="docutils literal notranslate"><span class="pre">route_geom</span></code></p></li>
<li><p>Ambas columnas deben tener la geometría corregida para la direccionalidad.</p></li>
</ul>
</li>
</ul>
<p class="rubric">Solución</p>
<p>Para obtener la dirección correcta, algunas geometrías deben invertirse:</p>
<ul class="simple">
<li><p>Reversing a geometry will depend on the <code class="docutils literal notranslate"><span class="pre">node</span></code> column of the query to
Dijkstra.</p></li>
<li><p>Una instrucción condicional <code class="docutils literal notranslate"><span class="pre">CASE</span></code> que devuelve la geometría en forma legible por humanos:</p>
<ul>
<li><p>Of the geometry when <code class="docutils literal notranslate"><span class="pre">node</span></code> is the <code class="docutils literal notranslate"><span class="pre">source</span></code> column.</p></li>
<li><p>Of the reversed geometry when <code class="docutils literal notranslate"><span class="pre">node</span></code> is not the <code class="docutils literal notranslate"><span class="pre">source</span></code> column.</p></li>
</ul>
</li>
<li><p>Una instrucción condicional <code class="docutils literal notranslate"><span class="pre">CASE</span></code> que devuelve:</p>
<ul>
<li><p>The geometry when <code class="docutils literal notranslate"><span class="pre">node</span></code> is the <code class="docutils literal notranslate"><span class="pre">source</span></code> column.</p></li>
<li><p>The reversed geometry when <code class="docutils literal notranslate"><span class="pre">node</span></code> is not the <code class="docutils literal notranslate"><span class="pre">source</span></code> column.</p></li>
</ul>
</li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">DROP</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="n">regclass</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">);</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">edges_subset</span><span class="w"> </span><span class="n">REGCLASS</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="k">length</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_readable</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_geom</span><span class="w"> </span><span class="n">geometry</span>
<span class="linenos"> 8</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="k">AS</span>
<span class="linenos">10</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">11</span><span class="k">WITH</span>
<span class="linenos">12</span><span class="n">results</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="linenos">13</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">seconds</span>
<span class="linenos">14</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstra</span><span class="p">(</span>
<span class="linenos">15</span><span class="w">    </span><span class="s1">&#39;SELECT * FROM &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">16</span><span class="w">    </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">)</span>
<span class="linenos">17</span><span class="p">)</span>
<span class="linenos">18</span><span class="k">SELECT</span>
<span class="linenos">19</span><span class="w">  </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">length</span><span class="p">,</span>
<span class="linenos">20</span><span class="w">  </span><span class="k">CASE</span>
<span class="linenos">21</span><span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
<span class="linenos">22</span><span class="w">      </span><span class="k">ELSE</span><span class="w"> </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">ST_Reverse</span><span class="p">(</span><span class="n">geom</span><span class="p">))</span>
<span class="linenos">23</span><span class="w">  </span><span class="k">END</span><span class="p">,</span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="w">  </span><span class="k">CASE</span>
<span class="linenos">26</span><span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">geom</span>
<span class="linenos">27</span><span class="w">      </span><span class="k">ELSE</span><span class="w"> </span><span class="n">ST_Reverse</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
<span class="linenos">28</span><span class="w">  </span><span class="k">END</span>
<span class="linenos">29</span><span class="k">FROM</span><span class="w"> </span><span class="n">results</span>
<span class="linenos">30</span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vehicle_net</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="linenos">31</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span>
<span class="linenos">32</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">33</span><span class="k">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="p">;</span>
<span class="linenos">34</span>
<span class="linenos">35</span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">route_readable</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="e84b54b1-1218-4167-b2dd-4dded2e164bb" name="e84b54b1-1218-4167-b2dd-4dded2e164bb" type="checkbox"><label class="sphinx_collapse__label" for="e84b54b1-1218-4167-b2dd-4dded2e164bb"><i class="sphinx_collapse__icon"></i>results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DROP</span> <span class="n">FUNCTION</span>
<span class="n">CREATE</span> <span class="n">FUNCTION</span>
</pre></div>
</div>
</div>
</div>
<p>Inspecting the problematic rows, the directionality has been fixed.</p>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="a6c0e15a-a5b6-4755-a827-cd47a4dfe0d5" name="a6c0e15a-a5b6-4755-a827-cd47a4dfe0d5" type="checkbox"><label class="sphinx_collapse__label" for="a6c0e15a-a5b6-4755-a827-cd47a4dfe0d5"><i class="sphinx_collapse__icon"></i>Query: Rows where criteria is not met</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span>
<span class="n">results</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">route_geom</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">)</span>
<span class="p">),</span>
<span class="n">compare</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">lead</span><span class="p">(</span><span class="n">route_geom</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">next_id</span><span class="p">,</span>
<span class="w">  </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">ST_endPoint</span><span class="p">(</span><span class="n">route_geom</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_end</span><span class="p">,</span>
<span class="w">  </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">ST_startPoint</span><span class="p">(</span><span class="n">lead</span><span class="p">(</span><span class="n">route_geom</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">next_id_start</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">results</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id_end</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">next_id_start</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</section>
<section id="exercise-5-using-the-geometry">
<h3><a class="toc-backref" href="#id25" role="doc-backlink"><span class="section-number">5.3.4. </span>Ejercicio 5: Uso de la geometría</a><a class="headerlink" href="#exercise-5-using-the-geometry" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/sql_azimuth_fixed.png"><img alt="Desde |ch7_place_1| al |ch7_place_2| mostrar el azimut" src="../_images/sql_azimuth_fixed.png" style="width: 300pt;" />
</a>
<p>Hay muchas funciones de geometría en PostGIS, el taller ya cubrió algunas de ellas como <code class="docutils literal notranslate"><span class="pre">ST_AsText</span></code>, <code class="docutils literal notranslate"><span class="pre">ST_Reverse</span></code>, <code class="docutils literal notranslate"><span class="pre">ST_EndPoint</span></code>, etc. Este ejercicio hará uso de una función adicional <code class="docutils literal notranslate"><span class="pre">ST_Azimuth</span></code>.</p>
<p class="rubric">Problema</p>
<p>Modificar la consulta del ejercicio anterior</p>
<ul class="simple">
<li><p>Additionally obtain the azimuth in degrees of the corrected geometry.</p></li>
</ul>
<p class="rubric">Solución</p>
<ul class="simple">
<li><p>The function returns <code class="docutils literal notranslate"><span class="pre">aximuth</span></code>. (line <strong>8</strong>)</p></li>
<li><p>The query from previous exercise is wrapped under additional subquery. (line
<strong>18</strong>)</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">azimuth</span></code> is processed in degrees. (line <strong>35</strong>).</p></li>
<li><p>Test from <a href="#id13"><span class="problematic" id="id14">|ch7_id_1|</span></a> to <a href="#id15"><span class="problematic" id="id16">|ch7_id_2|</span></a> on <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code>. (Last line)</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">DROP</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="n">regclass</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">);</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">edges_subset</span><span class="w"> </span><span class="n">REGCLASS</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="k">length</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_readable</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_geom</span><span class="w"> </span><span class="n">geometry</span><span class="p">,</span>
<span class="hll"><span class="linenos"> 8</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">azimuth</span><span class="w"> </span><span class="nb">FLOAT</span>
</span><span class="linenos"> 9</span><span class="p">)</span>
<span class="linenos">10</span><span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="k">AS</span>
<span class="linenos">11</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">12</span><span class="k">WITH</span>
<span class="linenos">13</span><span class="n">results</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="linenos">14</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">seconds</span>
<span class="linenos">15</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstra</span><span class="p">(</span>
<span class="linenos">16</span><span class="w">    </span><span class="s1">&#39;SELECT * FROM &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">17</span><span class="w">    </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">)),</span>
<span class="hll"><span class="linenos">18</span><span class="n">additional</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span class="linenos">19</span><span class="w">  </span><span class="k">SELECT</span>
<span class="linenos">20</span><span class="w">  </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">length</span><span class="p">,</span>
<span class="linenos">21</span><span class="w">  </span><span class="k">CASE</span>
<span class="linenos">22</span><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
<span class="linenos">23</span><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">ST_Reverse</span><span class="p">(</span><span class="n">geom</span><span class="p">))</span>
<span class="linenos">24</span><span class="w">  </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">readable</span><span class="p">,</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="w">  </span><span class="k">CASE</span>
<span class="linenos">27</span><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">geom</span>
<span class="linenos">28</span><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="n">ST_Reverse</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
<span class="linenos">29</span><span class="w">  </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">geom</span>
<span class="linenos">30</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">results</span>
<span class="linenos">31</span><span class="w">  </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vehicle_net</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="linenos">32</span><span class="w">  </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)</span>
<span class="linenos">33</span>
<span class="linenos">34</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="p">,</span>
<span class="hll"><span class="linenos">35</span><span class="w">  </span><span class="n">degrees</span><span class="p">(</span><span class="n">ST_azimuth</span><span class="p">(</span><span class="n">ST_StartPoint</span><span class="p">(</span><span class="n">geom</span><span class="p">),</span><span class="w"> </span><span class="n">ST_EndPoint</span><span class="p">(</span><span class="n">geom</span><span class="p">)))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">azimuth</span>
</span><span class="linenos">36</span><span class="k">FROM</span><span class="w"> </span><span class="n">additional</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span>
<span class="linenos">37</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">38</span><span class="k">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="p">;</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">azimuth</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="24e93201-4b0e-4fb7-81b3-1599145060d6" name="24e93201-4b0e-4fb7-81b3-1599145060d6" type="checkbox"><label class="sphinx_collapse__label" for="24e93201-4b0e-4fb7-81b3-1599145060d6"><i class="sphinx_collapse__icon"></i>results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DROP</span> <span class="n">FUNCTION</span>
<span class="n">CREATE</span> <span class="n">FUNCTION</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-6-using-the-function">
<h3><a class="toc-backref" href="#id26" role="doc-backlink"><span class="section-number">5.3.5. </span>Exercise 6: Using the function</a><a class="headerlink" href="#exercise-6-using-the-function" title="Link to this heading">¶</a></h3>
<p>Pruebe la función con una combinación de los lugares interesantes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">10840</span></code> Auckland University of Technology</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">936</span></code> The Band Rotunda</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">21570</span></code> Four Points by Sheraton</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">10928</span></code> Sky tower</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">12777</span></code> Emily Place Reserve</p></li>
</ul>
<p>Using different networks:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">taxi_net</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">walk_net</span></code></p></li>
</ul>
<p>Nombres de las calles de la ruta</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="ac4abe21-c362-428e-ba81-8c2adfdfaf39" name="ac4abe21-c362-428e-ba81-8c2adfdfaf39" type="checkbox"><label class="sphinx_collapse__label" for="ac4abe21-c362-428e-ba81-8c2adfdfaf39"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Total de segundos pasados en cada calle</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;taxi_net&#39;</span><span class="p">,</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">)</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="a03463ec-9728-460a-a303-076613100d5f" name="a03463ec-9728-460a-a303-076613100d5f" type="checkbox"><label class="sphinx_collapse__label" for="a03463ec-9728-460a-a303-076613100d5f"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Why it does not fully work with <code class="docutils literal notranslate"><span class="pre">walk_net</span></code>?</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;walk_net&#39;</span><span class="p">,</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="dc10120f-e4c5-4157-83cc-a98fe812768c" name="dc10120f-e4c5-4157-83cc-a98fe812768c" type="checkbox"><label class="sphinx_collapse__label" for="dc10120f-e4c5-4157-83cc-a98fe812768c"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2010-2025 pgRouting Developers.<br/>
      Actualizado por última vez en oct 07, 2025.<br/>
    </p>
  </div>
</footer>
  </body>
</html>