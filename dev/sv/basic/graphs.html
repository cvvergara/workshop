<!DOCTYPE html>

<html lang="sv" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>2. Graphs &#8212; Workshop - FOSS4G Auckland - Routing with pgRouting</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=5a695559" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css?v=226d88b4" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=fa3951f0" />
    <script src="../_static/documentation_options.js?v=b616604d"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/translations.js?v=55d7b627"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="search" title="Sök" href="../search.html" />
    <link rel="next" title="3. Routning av fotgängare" href="pedestrian.html" />
    <link rel="prev" title="1. Förbereda data" href="data.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="../index.html">
          Workshop FOSS4G Auckland</a>
        <span class="navbar-text pull-left"><b>3.1</b></span>

        <div class="nav-collapse">
          <ul class="nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://docs.pgrouting.org/latest/en/index.html">Documentation</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Chapters <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/introduction.html">1. Introduktion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/osgeolive.html">2. OSGeoLive-installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/overview.html">3. Översikt över programvara och data</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data.html">1. Förbereda data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="pedestrian.html">3. Routning av fotgängare</a></li>
<li class="toctree-l1"><a class="reference internal" href="vehicle.html">4. Routning av fordon</a></li>
<li class="toctree-l1"><a class="reference internal" href="sql_function.html">5. SQL-funktion</a></li>
<li class="toctree-l1"><a class="reference internal" href="withPoints.html">6. Routing using points</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/data.html">1. Data för målen för hållbar utveckling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/introduction.html">2. Uppnå målen för hållbar utveckling med pgRouting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/sdg3-health.html">3. God hälsa och välbefinnande</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/sdg7-energy.html">4. Prisvärd och ren energi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/sdg11-cities.html">5. Hållbara städer och samhällen</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-9.html">1. Använda Qgis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-10.html">2. WMS-server med GeoServer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-11.html">3. OpenLayers-baserat gränssnitt för routning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/chapter-12.html">4. Skapa en nätverkstopologi</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/boost_dijkstra.html">1. Dijkstra-exempel med Boost</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/hanoslav.html">2. Exempel från internet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/wiki_example.html">3. Dijkstra-exempel från Wikipedia</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-2.html">1. Bilaga: Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-3.html">2. Bilaga: Importverktyg för osm2pgrouting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-4.html">3. Videohandledningar för workshop</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">2. Graphs</a><ul>
<li><a class="reference internal" href="#the-graph-requirements">2.1. Kraven för grafen</a></li>
<li><a class="reference internal" href="#configuration-from-osm2pgrouting">2.2. Configuration from osm2pgrouting</a></li>
<li><a class="reference internal" href="#pgr-extractvertices">2.3. pgr_extractVertices</a><ul>
<li><a class="reference internal" href="#exercise-1-create-a-vertices-table">2.3.1. Övning 1: Skapa en vertices-tabell</a></li>
<li><a class="reference internal" href="#exercise-2-fill-up-other-columns-in-the-vertices-table">2.3.2. Övning 2: Fyll i andra kolumner i vertikaltabellen</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pgr-connectedcomponents">2.4. pgr_connectedComponents</a><ul>
<li><a class="reference internal" href="#exercise-3-set-components-on-edges-and-vertices-tables">2.4.1. Övning 3: Setkomponenter på kanter och hörntabeller</a></li>
<li><a class="reference internal" href="#exercise-4-inspect-the-components">2.4.2. Övning 4: Inspektera komponenterna</a></li>
</ul>
</li>
<li><a class="reference internal" href="#preparing-the-graphs">2.5. Förberedelse av graferna</a><ul>
<li><a class="reference internal" href="#exercise-5-creating-a-view-for-routing">2.5.1. Övning 5: Skapa en vy för routing</a></li>
<li><a class="reference internal" href="#exercise-6-limiting-the-road-network-within-an-area">2.5.2. Övning 6: Begränsa vägnätet inom ett område</a></li>
<li><a class="reference internal" href="#exercise-7-creating-a-materialized-view-for-routing-pedestrians">2.5.3. Övning 7: Skapa en materialiserad vy för att dirigera fotgängare</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pgr-dijkstracostmatrix">2.6. pgr_dijkstraCostMatrix</a><ul>
<li><a class="reference internal" href="#exercise-8-testing-the-views">2.6.1. Exercise 8: Testing the views</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="data.html" title="Previous Chapter: 1. Förbereda data"><span class="icon-chevron-left visible-tablet"></span><span class="hidden-sm hidden-tablet">&laquo; 1. Förbereda data</span>
    </a>
  </li>
  <li>
    <a href="pedestrian.html" title="Next Chapter: 3. Routning av fotgängare"><span class="icon-chevron-right visible-tablet"></span><span class="hidden-sm hidden-tablet">3. Routning a... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
      </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body span12 content" role="main">
      
  <section id="graphs">
<h1><a class="toc-backref" href="#id1" role="doc-backlink"><span class="section-number">2. </span>Graphs</a><a class="headerlink" href="#graphs" title="Link to this heading">¶</a></h1>
<a class="reference internal image-reference" href="../_images/taxi_net.png"><img alt="../_images/taxi_net.png" class="align-center" src="../_images/taxi_net.png" style="width: 371.5px; height: 217.25px;" />
</a>
<nav class="contents" id="chapter-contents">
<p class="topic-title">Kapitelinnehåll</p>
<ul class="simple">
<li><p><a class="reference internal" href="#graphs" id="id1">Graphs</a></p>
<ul>
<li><p><a class="reference internal" href="#the-graph-requirements" id="id2">Kraven för grafen</a></p></li>
<li><p><a class="reference internal" href="#configuration-from-osm2pgrouting" id="id3">Configuration from osm2pgrouting</a></p></li>
<li><p><a class="reference internal" href="#pgr-extractvertices" id="id4">pgr_extractVertices</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-1-create-a-vertices-table" id="id5">Övning 1: Skapa en vertices-tabell</a></p></li>
<li><p><a class="reference internal" href="#exercise-2-fill-up-other-columns-in-the-vertices-table" id="id6">Övning 2: Fyll i andra kolumner i vertikaltabellen</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#pgr-connectedcomponents" id="id7">pgr_connectedComponents</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-3-set-components-on-edges-and-vertices-tables" id="id8">Övning 3: Setkomponenter på kanter och hörntabeller</a></p></li>
<li><p><a class="reference internal" href="#exercise-4-inspect-the-components" id="id9">Övning 4: Inspektera komponenterna</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#preparing-the-graphs" id="id10">Förberedelse av graferna</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-5-creating-a-view-for-routing" id="id11">Övning 5: Skapa en vy för routing</a></p></li>
<li><p><a class="reference internal" href="#exercise-6-limiting-the-road-network-within-an-area" id="id12">Övning 6: Begränsa vägnätet inom ett område</a></p></li>
<li><p><a class="reference internal" href="#exercise-7-creating-a-materialized-view-for-routing-pedestrians" id="id13">Övning 7: Skapa en materialiserad vy för att dirigera fotgängare</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#pgr-dijkstracostmatrix" id="id14">pgr_dijkstraCostMatrix</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-8-testing-the-views" id="id15">Exercise 8: Testing the views</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<p>Olika applikationer kräver olika grafer. I det här kapitlet beskrivs hur man tar bort segment som inte är sammankopplade och olika sätt att skapa grafer.</p>
<p>pgRouting functions in this chapter</p>
<ul class="simple">
<li><p><a class="reference internal" href="#pgr-extractvertices">pgr_extractVertices</a></p></li>
<li><p><a class="reference internal" href="#pgr-connectedcomponents">pgr_connectedComponents</a></p></li>
<li><p><a class="reference internal" href="#pgr-dijkstracostmatrix">pgr_dijkstraCostMatrix</a></p></li>
</ul>
<section id="the-graph-requirements">
<h2><a class="toc-backref" href="#id2" role="doc-backlink"><span class="section-number">2.1. </span>Kraven för grafen</a><a class="headerlink" href="#the-graph-requirements" title="Link to this heading">¶</a></h2>
<p>In this chapter there are three graph requirements. It consists on three graphs
based on a <strong>fully connected</strong> graph derived from <code class="docutils literal notranslate"><span class="pre">ways</span></code>: two for different types
of vehicles and one for pedestrian, the source and the target in all of them are
based on the <code class="docutils literal notranslate"><span class="pre">source</span></code> and <code class="docutils literal notranslate"><span class="pre">target</span></code>.</p>
<p>Beskrivning av graferna:</p>
<ul class="simple">
<li><p>Särskilt fordon:</p>
<ul>
<li><p>Circulate on the whole Auckland area.</p>
<ul>
<li><p>Do not use <cite>pedestrian</cite>, <cite>steps</cite>, <cite>footway</cite>, <cite>path</cite>, <cite>cycleway</cite></p></li>
</ul>
</li>
<li><p>Speed är standardhastigheten från OSM-informationen.</p></li>
</ul>
</li>
<li><p>Taxifordon:</p>
<ul>
<li><p>Cirkulera på en mindre yta:</p>
<ul>
<li><p>Bounding box: <code class="docutils literal notranslate"><span class="pre">(174.775,-36.855,174.76,-36.84)</span></code></p></li>
<li><p>Do not use <cite>pedestrian</cite>, <cite>steps</cite>, <cite>footway</cite>, <cite>path</cite>, <cite>cycleway</cite></p></li>
</ul>
</li>
<li><p>Hastigheten är 10% långsammare än för de aktuella fordonen.</p></li>
</ul>
</li>
<li><p>Fotgängare:</p>
<ul>
<li><p>Walk on the whole Auckland area.</p></li>
<li><p>Can only use pedestrian only ways:</p>
<ul>
<li><p><cite>pedestrian</cite>, <cite>steps</cite>, <cite>footway</cite>, <cite>path</cite>, <cite>cycleway</cite></p></li>
</ul>
</li>
<li><p>The walking speed is <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">mts/sec</span></code>.</p></li>
</ul>
</li>
</ul>
</section>
<section id="configuration-from-osm2pgrouting">
<h2><a class="toc-backref" href="#id3" role="doc-backlink"><span class="section-number">2.2. </span>Configuration from osm2pgrouting</a><a class="headerlink" href="#configuration-from-osm2pgrouting" title="Link to this heading">¶</a></h2>
<p>When dealing with data, being aware of what kind of data is being used can
improve results.</p>
<ul class="simple">
<li><p>Vehicles can not circulate on pedestrian ways</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/pedestrian_only_roads.png"><img alt="../_images/pedestrian_only_roads.png" src="../_images/pedestrian_only_roads.png" style="width: 368.75px; height: 215.75px;" />
</a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Penalizing or removal of pedestrian ways will make the results closer to reality.</p>
<p>When converting data from OSM format using the <cite>osm2pgrouting</cite> tool, there is an
additional table: <code class="docutils literal notranslate"><span class="pre">configuration</span></code>.</p>
<p class="rubric">The <code class="docutils literal notranslate"><span class="pre">configuration</span></code> table structure can be obtained with the following command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">dS</span><span class="o">+</span> <span class="n">configuration</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="2d6e3546-3eaa-465e-898a-95c85e7d2e4e" name="2d6e3546-3eaa-465e-898a-95c85e7d2e4e" type="checkbox"><label class="sphinx_collapse__label" for="2d6e3546-3eaa-465e-898a-95c85e7d2e4e"><i class="sphinx_collapse__icon"></i>The table description</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                                                 <span class="n">Table</span> <span class="s2">&quot;public.configuration&quot;</span>
      <span class="n">Column</span>       <span class="o">|</span>       <span class="n">Type</span>       <span class="o">|</span> <span class="n">Collation</span> <span class="o">|</span> <span class="n">Nullable</span> <span class="o">|</span>                  <span class="n">Default</span>                  <span class="o">|</span> <span class="n">Storage</span>  <span class="o">|</span> <span class="n">Compression</span> <span class="o">|</span> <span class="n">Stats</span> <span class="n">target</span> <span class="o">|</span> <span class="n">Description</span> 
<span class="o">-------------------+------------------+-----------+----------+-------------------------------------------+----------+-------------+--------------+-------------</span>
 <span class="nb">id</span>                <span class="o">|</span> <span class="n">integer</span>          <span class="o">|</span>           <span class="o">|</span> <span class="ow">not</span> <span class="n">null</span> <span class="o">|</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;configuration_id_seq&#39;</span><span class="p">::</span><span class="n">regclass</span><span class="p">)</span> <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">tag_id</span>            <span class="o">|</span> <span class="n">integer</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>                                           <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">tag_key</span>           <span class="o">|</span> <span class="n">text</span>             <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>                                           <span class="o">|</span> <span class="n">extended</span> <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">tag_value</span>         <span class="o">|</span> <span class="n">text</span>             <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>                                           <span class="o">|</span> <span class="n">extended</span> <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">priority</span>          <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span> <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>                                           <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">maxspeed</span>          <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span> <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>                                           <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">maxspeed_forward</span>  <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span> <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>                                           <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">maxspeed_backward</span> <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span> <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>                                           <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">force</span>             <span class="o">|</span> <span class="n">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>     <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>                                           <span class="o">|</span> <span class="n">extended</span> <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
<span class="n">Indexes</span><span class="p">:</span>
    <span class="s2">&quot;configuration_pkey&quot;</span> <span class="n">PRIMARY</span> <span class="n">KEY</span><span class="p">,</span> <span class="n">btree</span> <span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="s2">&quot;configuration_tag_id_key&quot;</span> <span class="n">UNIQUE</span> <span class="n">CONSTRAINT</span><span class="p">,</span> <span class="n">btree</span> <span class="p">(</span><span class="n">tag_id</span><span class="p">)</span>
<span class="n">Referenced</span> <span class="n">by</span><span class="p">:</span>
    <span class="n">TABLE</span> <span class="s2">&quot;ways&quot;</span> <span class="n">CONSTRAINT</span> <span class="s2">&quot;ways_tag_id_fkey&quot;</span> <span class="n">FOREIGN</span> <span class="n">KEY</span> <span class="p">(</span><span class="n">tag_id</span><span class="p">)</span> <span class="n">REFERENCES</span> <span class="n">configuration</span><span class="p">(</span><span class="n">tag_id</span><span class="p">)</span>
<span class="n">Access</span> <span class="n">method</span><span class="p">:</span> <span class="n">heap</span>
<span class="n">Options</span><span class="p">:</span> <span class="n">autovacuum_enabled</span><span class="o">=</span><span class="n">false</span>

</pre></div>
</div>
</div>
</div>
<a class="reference internal image-reference" href="../_images/roads_tag_ids.png"><img alt="tag_id values" src="../_images/roads_tag_ids.png" style="width: 368.75px; height: 215.75px;" />
</a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>In the image above there is a detail of the <code class="docutils literal notranslate"><span class="pre">tag_id</span></code> of the roads.</p>
<p class="rubric">The <a class="reference external" href="https://wiki.openstreetmap.org/wiki/Key:highway">OSM highway</a>
types:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">tag_id</span><span class="p">,</span><span class="w"> </span><span class="n">tag_key</span><span class="p">,</span><span class="w"> </span><span class="n">tag_value</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">configuration</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">tag_id</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="cb05ae35-cf4c-4927-86a5-34973e035d47" name="cb05ae35-cf4c-4927-86a5-34973e035d47" type="checkbox"><label class="sphinx_collapse__label" for="cb05ae35-cf4c-4927-86a5-34973e035d47"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">tag_id</span> <span class="o">|</span>  <span class="n">tag_key</span>  <span class="o">|</span>     <span class="n">tag_value</span>     
<span class="o">--------+-----------+-------------------</span>
    <span class="mi">100</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">road</span>
    <span class="mi">101</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">motorway</span>
    <span class="mi">102</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">motorway_link</span>
    <span class="mi">103</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">motorway_junction</span>
    <span class="mi">104</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">trunk</span>
    <span class="mi">105</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">trunk_link</span>
    <span class="mi">106</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">primary</span>
    <span class="mi">107</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">primary_link</span>
    <span class="mi">108</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">secondary</span>
    <span class="mi">109</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">tertiary</span>
    <span class="mi">110</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">residential</span>
    <span class="mi">111</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">living_street</span>
    <span class="mi">112</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">service</span>
    <span class="mi">113</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">track</span>
    <span class="mi">114</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">pedestrian</span>
    <span class="mi">115</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">services</span>
    <span class="mi">116</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">bus_guideway</span>
    <span class="mi">117</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">path</span>
    <span class="mi">118</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">cycleway</span>
    <span class="mi">119</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">footway</span>
    <span class="mi">120</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">bridleway</span>
    <span class="mi">121</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">byway</span>
    <span class="mi">122</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">steps</span>
    <span class="mi">123</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">unclassified</span>
    <span class="mi">124</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">secondary_link</span>
    <span class="mi">125</span> <span class="o">|</span> <span class="n">highway</span>   <span class="o">|</span> <span class="n">tertiary_link</span>
    <span class="mi">201</span> <span class="o">|</span> <span class="n">cycleway</span>  <span class="o">|</span> <span class="n">lane</span>
    <span class="mi">202</span> <span class="o">|</span> <span class="n">cycleway</span>  <span class="o">|</span> <span class="n">track</span>
    <span class="mi">203</span> <span class="o">|</span> <span class="n">cycleway</span>  <span class="o">|</span> <span class="n">opposite_lane</span>
    <span class="mi">204</span> <span class="o">|</span> <span class="n">cycleway</span>  <span class="o">|</span> <span class="n">opposite</span>
    <span class="mi">301</span> <span class="o">|</span> <span class="n">tracktype</span> <span class="o">|</span> <span class="n">grade1</span>
    <span class="mi">302</span> <span class="o">|</span> <span class="n">tracktype</span> <span class="o">|</span> <span class="n">grade2</span>
    <span class="mi">303</span> <span class="o">|</span> <span class="n">tracktype</span> <span class="o">|</span> <span class="n">grade3</span>
    <span class="mi">304</span> <span class="o">|</span> <span class="n">tracktype</span> <span class="o">|</span> <span class="n">grade4</span>
    <span class="mi">305</span> <span class="o">|</span> <span class="n">tracktype</span> <span class="o">|</span> <span class="n">grade5</span>
    <span class="mi">401</span> <span class="o">|</span> <span class="n">junction</span>  <span class="o">|</span> <span class="n">roundabout</span>
<span class="p">(</span><span class="mi">36</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p>Also, on the <code class="docutils literal notranslate"><span class="pre">ways</span></code> table there is a column that can be used to <code class="docutils literal notranslate"><span class="pre">JOIN</span></code> with the <code class="docutils literal notranslate"><span class="pre">configuration</span></code> table.</p>
<p class="rubric">The configuration types in the Auckland data</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">SELECT</span> <span class="n">distinct</span> <span class="n">tag_id</span><span class="p">,</span> <span class="n">tag_key</span><span class="p">,</span> <span class="n">tag_value</span>
<span class="n">FROM</span> <span class="n">ways</span> <span class="n">JOIN</span> <span class="n">configuration</span> <span class="n">USING</span> <span class="p">(</span><span class="n">tag_id</span><span class="p">)</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="n">tag_id</span><span class="p">;</span>

</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="a27976c6-8484-4450-abb8-0e8930df615c" name="a27976c6-8484-4450-abb8-0e8930df615c" type="checkbox"><label class="sphinx_collapse__label" for="a27976c6-8484-4450-abb8-0e8930df615c"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">tag_id</span> <span class="o">|</span> <span class="n">tag_key</span>  <span class="o">|</span>   <span class="n">tag_value</span>    
<span class="o">--------+----------+----------------</span>
    <span class="mi">101</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">motorway</span>
    <span class="mi">102</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">motorway_link</span>
    <span class="mi">104</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">trunk</span>
    <span class="mi">105</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">trunk_link</span>
    <span class="mi">106</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">primary</span>
    <span class="mi">107</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">primary_link</span>
    <span class="mi">108</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">secondary</span>
    <span class="mi">109</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">tertiary</span>
    <span class="mi">110</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">residential</span>
    <span class="mi">111</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">living_street</span>
    <span class="mi">112</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">service</span>
    <span class="mi">113</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">track</span>
    <span class="mi">114</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">pedestrian</span>
    <span class="mi">115</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">services</span>
    <span class="mi">117</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">path</span>
    <span class="mi">118</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">cycleway</span>
    <span class="mi">119</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">footway</span>
    <span class="mi">122</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">steps</span>
    <span class="mi">123</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">unclassified</span>
    <span class="mi">124</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">secondary_link</span>
    <span class="mi">125</span> <span class="o">|</span> <span class="n">highway</span>  <span class="o">|</span> <span class="n">tertiary_link</span>
    <span class="mi">201</span> <span class="o">|</span> <span class="n">cycleway</span> <span class="o">|</span> <span class="n">lane</span>
    <span class="mi">202</span> <span class="o">|</span> <span class="n">cycleway</span> <span class="o">|</span> <span class="n">track</span>
<span class="p">(</span><span class="mi">23</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
</section>
<section id="pgr-extractvertices">
<h2><a class="toc-backref" href="#id4" role="doc-backlink"><span class="section-number">2.3. </span>pgr_extractVertices</a><a class="headerlink" href="#pgr-extractvertices" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">pgr_extractVertices</span></code> extracting the vertex information of the set of edges of
a graph.</p>
<p class="rubric">Sammanfattning av signatur</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">pgr_extractVertices</span><span class="p">(</span><span class="n">Edges</span><span class="w"> </span><span class="k">SQL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">dryrun</span><span class="p">])</span>

<span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">in_edges</span><span class="p">,</span><span class="w"> </span><span class="n">out_edges</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="p">)</span>
<span class="k">OR</span><span class="w"> </span><span class="n">EMPTY</span><span class="w"> </span><span class="k">SET</span>
</pre></div>
</div>
<p>Description of the function can be found in <a class="reference external" href="https://docs.pgrouting.org/latest/en/pgr_extractVertices.html">pgr_extractVertices</a></p>
<section id="exercise-1-create-a-vertices-table">
<h3><a class="toc-backref" href="#id5" role="doc-backlink"><span class="section-number">2.3.1. </span>Övning 1: Skapa en vertices-tabell</a><a class="headerlink" href="#exercise-1-create-a-vertices-table" title="Link to this heading">¶</a></h3>
<p class="rubric">Problem</p>
<p>Skapa en tabell med toppar som motsvarar kanterna i <code class="docutils literal notranslate"><span class="pre">ways</span></code>.</p>
<p class="rubric">Lösning</p>
<ul class="simple">
<li><p>En graf består av en uppsättning hörn och en uppsättning kanter.</p></li>
<li><p>I detta fall är tabellen <code class="docutils literal notranslate"><span class="pre">ways</span></code> en uppsättning kanter.</p></li>
<li><p>För att kunna använda alla graffunktioner i pgRouting krävs det att uppsättningen av hörnpunkter är definierad.</p></li>
<li><p>From the requirements, a fully connected graph is needed, therefore adding a
<code class="docutils literal notranslate"><span class="pre">component</span></code> column.</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">in_edges</span><span class="p">,</span><span class="w"> </span><span class="n">out_edges</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">::</span><span class="nb">BIGINT</span><span class="w"> </span><span class="n">osm_id</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">::</span><span class="nb">BIGINT</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span>
<span class="k">INTO</span><span class="w"> </span><span class="n">vertices</span>
<span class="hll"><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_extractVertices</span><span class="p">(</span>
</span><span class="w">  </span><span class="s1">&#39;SELECT gid AS id, source, target</span>
<span class="s1">  FROM ways ORDER BY id&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="ee4df084-74c9-450b-ac0b-80ac5a688cd6" name="ee4df084-74c9-450b-ac0b-80ac5a688cd6" type="checkbox"><label class="sphinx_collapse__label" for="ee4df084-74c9-450b-ac0b-80ac5a688cd6"><i class="sphinx_collapse__icon"></i>Number of inserted records</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="mi">25692</span>
</pre></div>
</div>
</div>
</div>
<p>Granskning av beskrivningen av vertices-tabellen</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">dS</span><span class="o">+</span> <span class="n">vertices</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="65c84f13-ad0b-4b96-9266-b8f84673b861" name="65c84f13-ad0b-4b96-9266-b8f84673b861" type="checkbox"><label class="sphinx_collapse__label" for="65c84f13-ad0b-4b96-9266-b8f84673b861"><i class="sphinx_collapse__icon"></i>The table description</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                               <span class="n">Table</span> <span class="s2">&quot;public.vertices&quot;</span>
  <span class="n">Column</span>   <span class="o">|</span>       <span class="n">Type</span>       <span class="o">|</span> <span class="n">Collation</span> <span class="o">|</span> <span class="n">Nullable</span> <span class="o">|</span> <span class="n">Default</span> <span class="o">|</span> <span class="n">Storage</span>  <span class="o">|</span> <span class="n">Compression</span> <span class="o">|</span> <span class="n">Stats</span> <span class="n">target</span> <span class="o">|</span> <span class="n">Description</span> 
<span class="o">-----------+------------------+-----------+----------+---------+----------+-------------+--------------+-------------</span>
 <span class="nb">id</span>        <span class="o">|</span> <span class="n">bigint</span>           <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">in_edges</span>  <span class="o">|</span> <span class="n">bigint</span><span class="p">[]</span>         <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">extended</span> <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">out_edges</span> <span class="o">|</span> <span class="n">bigint</span><span class="p">[]</span>         <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">extended</span> <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">x</span>         <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span> <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">y</span>         <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span> <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">osm_id</span>    <span class="o">|</span> <span class="n">bigint</span>           <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">component</span> <span class="o">|</span> <span class="n">bigint</span>           <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">geom</span>      <span class="o">|</span> <span class="n">geometry</span>         <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">main</span>     <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
<span class="n">Access</span> <span class="n">method</span><span class="p">:</span> <span class="n">heap</span>

</pre></div>
</div>
</div>
</div>
<p>Inspektera informationen i tabellen vertices</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">vertices</span><span class="w"> </span><span class="k">Limit</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="32bd73be-a9ba-491d-9f36-9895507abfbf" name="32bd73be-a9ba-491d-9f36-9895507abfbf" type="checkbox"><label class="sphinx_collapse__label" for="32bd73be-a9ba-491d-9f36-9895507abfbf"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="nb">id</span>   <span class="o">|</span>   <span class="n">in_edges</span>    <span class="o">|</span>  <span class="n">out_edges</span>  <span class="o">|</span> <span class="n">x</span> <span class="o">|</span> <span class="n">y</span> <span class="o">|</span> <span class="n">osm_id</span> <span class="o">|</span> <span class="n">component</span> <span class="o">|</span> <span class="n">geom</span> 
<span class="o">-------+---------------+-------------+---+---+--------+-----------+------</span>
  <span class="mi">1269</span> <span class="o">|</span> <span class="p">{</span><span class="mi">1611</span><span class="p">}</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">604</span><span class="p">}</span>       <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>        <span class="o">|</span>           <span class="o">|</span> 
  <span class="mi">4790</span> <span class="o">|</span> <span class="p">{</span><span class="mi">5404</span><span class="p">,</span><span class="mi">15924</span><span class="p">}</span>  <span class="o">|</span> <span class="p">{</span><span class="mi">110</span><span class="p">,</span><span class="mi">28086</span><span class="p">}</span> <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>        <span class="o">|</span>           <span class="o">|</span> 
  <span class="mi">6396</span> <span class="o">|</span> <span class="p">{</span><span class="mi">7059</span><span class="p">}</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">384</span><span class="p">,</span><span class="mi">7058</span><span class="p">}</span>  <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>        <span class="o">|</span>           <span class="o">|</span> 
  <span class="mi">8336</span> <span class="o">|</span> <span class="p">{</span><span class="mi">9210</span><span class="p">}</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">429</span><span class="p">}</span>       <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>        <span class="o">|</span>           <span class="o">|</span> 
    <span class="mi">51</span> <span class="o">|</span> <span class="p">{</span><span class="mi">69</span><span class="p">,</span><span class="mi">70</span><span class="p">}</span>       <span class="o">|</span> <span class="p">{</span><span class="mi">71</span><span class="p">,</span><span class="mi">10294</span><span class="p">}</span>  <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>        <span class="o">|</span>           <span class="o">|</span> 
 <span class="mi">13527</span> <span class="o">|</span> <span class="p">{</span><span class="mi">14259</span><span class="p">,</span><span class="mi">19725</span><span class="p">}</span> <span class="o">|</span> <span class="p">{</span><span class="mi">936</span><span class="p">,</span><span class="mi">30377</span><span class="p">}</span> <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>        <span class="o">|</span>           <span class="o">|</span> 
   <span class="mi">758</span> <span class="o">|</span> <span class="p">{</span><span class="mi">1008</span><span class="p">}</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">718</span><span class="p">,</span><span class="mi">6787</span><span class="p">}</span>  <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>        <span class="o">|</span>           <span class="o">|</span> 
 <span class="mi">13520</span> <span class="o">|</span> <span class="p">{</span><span class="mi">14252</span><span class="p">,</span><span class="mi">17115</span><span class="p">}</span> <span class="o">|</span> <span class="p">{</span><span class="mi">921</span><span class="p">,</span><span class="mi">30368</span><span class="p">}</span> <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>        <span class="o">|</span>           <span class="o">|</span> 
  <span class="mi">4326</span> <span class="o">|</span> <span class="p">{</span><span class="mi">4925</span><span class="p">,</span><span class="mi">15893</span><span class="p">}</span>  <span class="o">|</span> <span class="p">{</span><span class="mi">466</span><span class="p">,</span><span class="mi">30909</span><span class="p">}</span> <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>        <span class="o">|</span>           <span class="o">|</span> 
  <span class="mi">5337</span> <span class="o">|</span> <span class="p">{</span><span class="mi">5970</span><span class="p">}</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">193</span><span class="p">}</span>       <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>        <span class="o">|</span>           <span class="o">|</span> 
<span class="p">(</span><span class="mi">10</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-2-fill-up-other-columns-in-the-vertices-table">
<h3><a class="toc-backref" href="#id6" role="doc-backlink"><span class="section-number">2.3.2. </span>Övning 2: Fyll i andra kolumner i vertikaltabellen</a><a class="headerlink" href="#exercise-2-fill-up-other-columns-in-the-vertices-table" title="Link to this heading">¶</a></h3>
<p class="rubric">Problem</p>
<p>Fyll i geometriinformation i tabellen Vertices.</p>
<p class="rubric">Lösning</p>
<p>Räkna antalet rader som måste fyllas på.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">vertices</span> <span class="n">WHERE</span> <span class="n">geom</span> <span class="n">IS</span> <span class="n">NULL</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="8be2e298-1f89-4a36-ac0b-ba0a01b6a169" name="8be2e298-1f89-4a36-ac0b-ba0a01b6a169" type="checkbox"><label class="sphinx_collapse__label" for="8be2e298-1f89-4a36-ac0b-ba0a01b6a169"><i class="sphinx_collapse__icon"></i>Number of rows with empty geometry</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
 <span class="mi">25692</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p class="rubric">Update the <code class="docutils literal notranslate"><span class="pre">geom</span></code> and <code class="docutils literal notranslate"><span class="pre">osm_id</span></code> columns</p>
<ul class="simple">
<li><p>The update based on the <code class="docutils literal notranslate"><span class="pre">source</span></code> column from <code class="docutils literal notranslate"><span class="pre">ways</span></code> table and the <code class="docutils literal notranslate"><span class="pre">id</span></code>
column of the vertices table.</p></li>
<li><p>To update <code class="docutils literal notranslate"><span class="pre">geom</span></code> column, use the start point of the geometry on the <code class="docutils literal notranslate"><span class="pre">ways</span></code>
table.</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">source_osm</span></code> value to fill up <code class="docutils literal notranslate"><span class="pre">osm_id</span></code> column.</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">vertices</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="p">(</span><span class="n">geom</span><span class="p">,</span><span class="w"> </span><span class="n">osm_id</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ST_startPoint</span><span class="p">(</span><span class="n">the_geom</span><span class="p">),</span><span class="w"> </span><span class="n">source_osm</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
</pre></div>
</div>
<p class="rubric">Verification</p>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="d7f02891-9b60-4a19-ada9-743b11bcb7a9" name="d7f02891-9b60-4a19-ada9-743b11bcb7a9" type="checkbox"><label class="sphinx_collapse__label" for="d7f02891-9b60-4a19-ada9-743b11bcb7a9"><i class="sphinx_collapse__icon"></i>Number of updated records</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="mi">23843</span>
</pre></div>
</div>
</div>
</div>
<p>Not expecting to be done due to the fact that some vertices are dead ends.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">vertices</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="93ba5aff-bd9a-492c-a0cf-3d32239aec97" name="93ba5aff-bd9a-492c-a0cf-3d32239aec97" type="checkbox"><label class="sphinx_collapse__label" for="93ba5aff-bd9a-492c-a0cf-3d32239aec97"><i class="sphinx_collapse__icon"></i>Numbers of records that need update</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
  <span class="mi">1849</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p class="rubric">Continue update the <code class="docutils literal notranslate"><span class="pre">geom</span></code> and <code class="docutils literal notranslate"><span class="pre">osm_id</span></code> columns</p>
<ul class="simple">
<li><p>The update based on the <code class="docutils literal notranslate"><span class="pre">target</span></code> column from <code class="docutils literal notranslate"><span class="pre">ways</span></code> table and the <code class="docutils literal notranslate"><span class="pre">id</span></code>
column of the vertices table.</p></li>
<li><p>To update <code class="docutils literal notranslate"><span class="pre">geom</span></code> column, use the end point of the geometry on the <code class="docutils literal notranslate"><span class="pre">ways</span></code>
table.</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">target_osm</span></code> value to fill up <code class="docutils literal notranslate"><span class="pre">osm_id</span></code> column.</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">vertices</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="p">(</span><span class="n">geom</span><span class="p">,</span><span class="w"> </span><span class="n">osm_id</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ST_endPoint</span><span class="p">(</span><span class="n">the_geom</span><span class="p">),</span><span class="w"> </span><span class="n">target_osm</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
</pre></div>
</div>
<p class="rubric">Verification</p>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="a0716d1d-0ae4-4339-8ded-c49f1e0d8837" name="a0716d1d-0ae4-4339-8ded-c49f1e0d8837" type="checkbox"><label class="sphinx_collapse__label" for="a0716d1d-0ae4-4339-8ded-c49f1e0d8837"><i class="sphinx_collapse__icon"></i>Number of updated records</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="mi">1849</span>
</pre></div>
</div>
</div>
</div>
<p>Förväntar sig att det ska göras, det vill säga att geometrikolumnen inte ska ha ett <code class="docutils literal notranslate"><span class="pre">NULL</span></code>-värde.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">vertices</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="094a9737-0574-430f-9311-687352a78e9e" name="094a9737-0574-430f-9311-687352a78e9e" type="checkbox"><label class="sphinx_collapse__label" for="094a9737-0574-430f-9311-687352a78e9e"><i class="sphinx_collapse__icon"></i>Count should be 0</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
     <span class="mi">0</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p class="rubric">Update the <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> columns</p>
<p>Uppdatera kolumnerna <code class="docutils literal notranslate"><span class="pre">x</span></code> och <code class="docutils literal notranslate"><span class="pre">y</span></code> baserat på kolumnen <code class="docutils literal notranslate"><span class="pre">geom</span></code>.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">vertices</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ST_X</span><span class="p">(</span><span class="n">geom</span><span class="p">),</span><span class="w"> </span><span class="n">ST_Y</span><span class="p">(</span><span class="n">geom</span><span class="p">));</span>
</pre></div>
</div>
<p class="rubric">Verification</p>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="0924d48d-3a98-418b-8012-a072bcd4825e" name="0924d48d-3a98-418b-8012-a072bcd4825e" type="checkbox"><label class="sphinx_collapse__label" for="0924d48d-3a98-418b-8012-a072bcd4825e"><i class="sphinx_collapse__icon"></i>Number of updated records</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="mi">25692</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="pgr-connectedcomponents">
<h2><a class="toc-backref" href="#id7" role="doc-backlink"><span class="section-number">2.4. </span>pgr_connectedComponents</a><a class="headerlink" href="#pgr-connectedcomponents" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">pgr_connectedComponents</span></code> beräknar de anslutna komponenterna i en odelad graf med hjälp av Depth First Search. En ansluten komponent i en odelad graf är en uppsättning hörn som alla är nåbara från varandra.</p>
<p class="rubric">Sammanfattning av signatur</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">pgr_connectedComponents</span><span class="p">(</span><span class="n">edges_sql</span><span class="p">)</span>

<span class="k">RETURNS</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="p">(</span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">)</span>
<span class="k">OR</span><span class="w"> </span><span class="n">EMPTY</span><span class="w"> </span><span class="k">SET</span>
</pre></div>
</div>
<p>Beskrivning av funktionen finns i <a class="reference external" href="https://docs.pgrouting.org/latest/en/pgr_connectedComponents.html">pgr_connectedComponents</a></p>
<section id="exercise-3-set-components-on-edges-and-vertices-tables">
<h3><a class="toc-backref" href="#id8" role="doc-backlink"><span class="section-number">2.4.1. </span>Övning 3: Setkomponenter på kanter och hörntabeller</a><a class="headerlink" href="#exercise-3-set-components-on-edges-and-vertices-tables" title="Link to this heading">¶</a></h3>
<p class="rubric">Problem</p>
<p>Hämta information om grafens komponenter.</p>
<p class="rubric">Lösning</p>
<p>Create additional columns on the edges tables.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="37585660-8e2e-4a02-82b3-80127f2dec5e" name="37585660-8e2e-4a02-82b3-80127f2dec5e" type="checkbox"><label class="sphinx_collapse__label" for="37585660-8e2e-4a02-82b3-80127f2dec5e"><i class="sphinx_collapse__icon"></i>Command output</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">Använd <code class="docutils literal notranslate"><span class="pre">pgr_connectedComponents</span></code> för att fylla i tabellen med hörnpunkter.</p>
<ul class="simple">
<li><p>Use the results to store the component numbers on the vertices table.</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="k">UPDATE</span><span class="w"> </span><span class="n">vertices</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">component</span>
</span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">node</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_connectedComponents</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;SELECT gid as id, source, target, cost, reverse_cost FROM ways&#39;</span>
<span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">node</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="0e3b2319-3f73-4233-825b-792f79f004f4" name="0e3b2319-3f73-4233-825b-792f79f004f4" type="checkbox"><label class="sphinx_collapse__label" for="0e3b2319-3f73-4233-825b-792f79f004f4"><i class="sphinx_collapse__icon"></i>Number of updated records</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="mi">25692</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">Uppdatera tabellen med kanter baserat på toppunktens komponentnummer</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">component</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">vertices</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">v</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="b6704cb9-8dcc-4237-876e-70013fa6fc02" name="b6704cb9-8dcc-4237-876e-70013fa6fc02" type="checkbox"><label class="sphinx_collapse__label" for="b6704cb9-8dcc-4237-876e-70013fa6fc02"><i class="sphinx_collapse__icon"></i>Number of updated records</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="mi">34278</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-4-inspect-the-components">
<h3><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">2.4.2. </span>Övning 4: Inspektera komponenterna</a><a class="headerlink" href="#exercise-4-inspect-the-components" title="Link to this heading">¶</a></h3>
<p class="rubric">Problem</p>
<p>Svara på följande frågor:</p>
<ol class="arabic simple">
<li><p>Hur många komponenter finns det i vertices-tabellen?</p></li>
<li><p>Hur många komponenter finns det i kantbordet?</p></li>
<li><p>Lista de 10 komponenter som har flest kanter.</p></li>
<li><p>Hämta komponenten med det maximala antalet kanter.</p></li>
</ol>
<p class="rubric">Lösning</p>
<p class="rubric">1. How many components are in the vertices table?</p>
<p>Räkna de olika komponenterna.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">component</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">vertices</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="c92857f8-f059-4a53-a00b-fc7291a7f8f3" name="c92857f8-f059-4a53-a00b-fc7291a7f8f3" type="checkbox"><label class="sphinx_collapse__label" for="c92857f8-f059-4a53-a00b-fc7291a7f8f3"><i class="sphinx_collapse__icon"></i>Number of components on vertex table</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
   <span class="mi">327</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p class="rubric">2. How many components are in the edges table?</p>
<p>Räkna de olika komponenterna.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">component</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ways</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="8065a024-63fa-475d-b3f0-94b746e7da34" name="8065a024-63fa-475d-b3f0-94b746e7da34" type="checkbox"><label class="sphinx_collapse__label" for="8065a024-63fa-475d-b3f0-94b746e7da34"><i class="sphinx_collapse__icon"></i>Number of components on edge table</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
   <span class="mi">327</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p class="rubric">3. List the 10 components with more edges.</p>
<ul class="simple">
<li><p>Räkna antal rader grupperade efter komponent. (<strong>rad 1</strong>)</p></li>
<li><p>Omvänd ordning för att visa topp 10. (<strong>rad 2</strong>)</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">component</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">count</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="6d13e0e5-c542-4233-bf77-981884d21317" name="6d13e0e5-c542-4233-bf77-981884d21317" type="checkbox"><label class="sphinx_collapse__label" for="6d13e0e5-c542-4233-bf77-981884d21317"><i class="sphinx_collapse__icon"></i>Top 10 components</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">component</span> <span class="o">|</span> <span class="n">count</span> 
<span class="o">-----------+-------</span>
         <span class="mi">1</span> <span class="o">|</span> <span class="mi">33088</span>
       <span class="mi">870</span> <span class="o">|</span>   <span class="mi">468</span>
       <span class="mi">866</span> <span class="o">|</span>    <span class="mi">56</span>
     <span class="mi">18805</span> <span class="o">|</span>    <span class="mi">40</span>
     <span class="mi">21000</span> <span class="o">|</span>    <span class="mi">28</span>
      <span class="mi">2165</span> <span class="o">|</span>    <span class="mi">21</span>
      <span class="mi">4627</span> <span class="o">|</span>    <span class="mi">17</span>
      <span class="mi">9323</span> <span class="o">|</span>    <span class="mi">17</span>
     <span class="mi">15304</span> <span class="o">|</span>    <span class="mi">16</span>
     <span class="mi">15962</span> <span class="o">|</span>    <span class="mi">15</span>
<span class="p">(</span><span class="mi">10</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p class="rubric">4. Get the component with the maximum number of edges.</p>
<ul class="simple">
<li><p>Använd frågan från förra frågan för att få det maximala antalet</p></li>
<li><p>Hämta den komponent som matchar det högsta värdet.</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span>
<span class="n">all_components</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">component</span><span class="p">),</span>
<span class="n">max_component</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="k">count</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">all_components</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">all_components</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">max</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">max_component</span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="3f74df6e-9f63-42a2-9941-6ac348160be9" name="3f74df6e-9f63-42a2-9941-6ac348160be9" type="checkbox"><label class="sphinx_collapse__label" for="3f74df6e-9f63-42a2-9941-6ac348160be9"><i class="sphinx_collapse__icon"></i>Component with maxmum edge count</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">component</span> 
<span class="o">-----------</span>
         <span class="mi">1</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="preparing-the-graphs">
<h2><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">2.5. </span>Förberedelse av graferna</a><a class="headerlink" href="#preparing-the-graphs" title="Link to this heading">¶</a></h2>
<section id="exercise-5-creating-a-view-for-routing">
<h3><a class="toc-backref" href="#id11" role="doc-backlink"><span class="section-number">2.5.1. </span>Övning 5: Skapa en vy för routing</a><a class="headerlink" href="#exercise-5-creating-a-view-for-routing" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/vehicle_net.png"><img alt="Utsikt över vägar för fordon" src="../_images/vehicle_net.png" style="width: 371.5px; height: 217.25px;" />
</a>
<p class="rubric">Problem</p>
<ul class="simple">
<li><p>Skapa en vy med minimal mängd information för att bearbeta de specifika fordonen.</p></li>
<li><p>Routing <cite>cost</cite> och <cite>reverse_cost</cite> i sekunder för beräkningar av routing.</p></li>
<li><p>Utesluta segmenten <cite>steps</cite>, <cite>footway</cite>, <cite>path</cite>, <cite>cycleway</cite>.</p></li>
<li><p>Data som behövs i vyn för vidare bearbetning.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> The name of the segment.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">length_m</span></code> The length in meters rename to <code class="docutils literal notranslate"><span class="pre">length</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">the_geom</span></code> The geometry rename to <code class="docutils literal notranslate"><span class="pre">geom</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tag_id</span></code> Keep as is.</p></li>
</ul>
</li>
<li><p>Kontrollera att antalet kanter har minskats.</p></li>
</ul>
<p class="rubric">Lösning</p>
<p>Skapa en vy:</p>
<ul class="simple">
<li><p>Om du behöver rekonstruera vyn, släpp den först med hjälp av kommandot på <strong>rad 1</strong>.</p></li>
<li><p>Hämta komponenten med maximalt antal kanter (<strong>raderna 6-10</strong>)</p></li>
<li><p>Kraven på <cite>source</cite> och <cite>target</cite> för funktionen ska vara med OSM-identifierare. (rad <strong>14</strong>)</p></li>
<li><p>Kostnaden och den omvända kostnaden anges i sekunder. (rad <strong>15</strong>)</p></li>
<li><p>De ytterligare parametrarna <code class="docutils literal notranslate"><span class="pre">length_m</span></code> och <code class="docutils literal notranslate"><span class="pre">the_geom</span></code> har bytt namn, <code class="docutils literal notranslate"><span class="pre">name</span></code> ingår också. (rad <strong>16</strong>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">JOIN</span></code> med <cite>konfigurationen</cite>:</p>
<ul>
<li><p>Exkludera <cite>steps</cite>, <cite>footway</cite>, <cite>path</cite>, <cite>cycleway</cite>. (rad <strong>18</strong>)</p></li>
</ul>
</li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">-- DROP VIEW vehicle_net CASCADE;</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">vehicle_net</span><span class="w"> </span><span class="k">AS</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">WITH</span>
<span class="linenos"> 6</span><span class="n">all_components</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">component</span><span class="p">),</span><span class="w"> </span><span class="c1">-- line 6</span>
<span class="linenos"> 7</span><span class="n">max_component</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="k">count</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">all_components</span><span class="p">),</span>
<span class="linenos"> 8</span><span class="n">the_component</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">all_components</span>
<span class="linenos">10</span><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="k">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">max</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">max_component</span><span class="p">))</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="k">SELECT</span>
<span class="linenos">13</span><span class="w">  </span><span class="n">gid</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="linenos">14</span><span class="w">  </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">,</span>
<span class="linenos">15</span><span class="w">  </span><span class="n">cost_s</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cost</span><span class="p">,</span><span class="w"> </span><span class="n">reverse_cost_s</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">reverse_cost</span><span class="p">,</span>
<span class="linenos">16</span><span class="w">  </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">length_m</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">length</span><span class="p">,</span><span class="w"> </span><span class="n">tag_id</span><span class="p">,</span><span class="w"> </span><span class="n">the_geom</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">geom</span>
<span class="linenos">17</span><span class="k">FROM</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">the_component</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">component</span><span class="p">)</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">tag_id</span><span class="p">)</span>
<span class="linenos">18</span><span class="k">WHERE</span><span class="w">  </span><span class="n">tag_value</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;pedestrian&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;steps&#39;</span><span class="p">,</span><span class="s1">&#39;footway&#39;</span><span class="p">,</span><span class="s1">&#39;path&#39;</span><span class="p">,</span><span class="s1">&#39;cycleway&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">-- line 18</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="a4917e4f-92ea-4421-9553-05ec79bab540" name="a4917e4f-92ea-4421-9553-05ec79bab540" type="checkbox"><label class="sphinx_collapse__label" for="a4917e4f-92ea-4421-9553-05ec79bab540"><i class="sphinx_collapse__icon"></i>Command output</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">VIEW</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">Verification</p>
<p>Räkna raderna på de ursprungliga <code class="docutils literal notranslate"><span class="pre">ways</span></code> och på <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">ways</span><span class="p">;</span>
<span class="n">SELECT</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">vehicle_net</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="496e17f5-c18d-4191-b3be-97a4c359c727" name="496e17f5-c18d-4191-b3be-97a4c359c727" type="checkbox"><label class="sphinx_collapse__label" for="496e17f5-c18d-4191-b3be-97a4c359c727"><i class="sphinx_collapse__icon"></i>Row count results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
 <span class="mi">34278</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

 <span class="n">count</span> 
<span class="o">-------</span>
 <span class="mi">12984</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p>Hämta beskrivningen av vyn</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">dS</span><span class="o">+</span> <span class="n">vehicle_net</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="7896aed7-e3cc-463c-aa54-66480c6adaf2" name="7896aed7-e3cc-463c-aa54-66480c6adaf2" type="checkbox"><label class="sphinx_collapse__label" for="7896aed7-e3cc-463c-aa54-66480c6adaf2"><i class="sphinx_collapse__icon"></i>The view description</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                     <span class="n">View</span> <span class="s2">&quot;public.vehicle_net&quot;</span>
    <span class="n">Column</span>    <span class="o">|</span>           <span class="n">Type</span>            <span class="o">|</span> <span class="n">Collation</span> <span class="o">|</span> <span class="n">Nullable</span> <span class="o">|</span> <span class="n">Default</span> <span class="o">|</span> <span class="n">Storage</span>  <span class="o">|</span> <span class="n">Description</span> 
<span class="o">--------------+---------------------------+-----------+----------+---------+----------+-------------</span>
 <span class="nb">id</span>           <span class="o">|</span> <span class="n">bigint</span>                    <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">source</span>       <span class="o">|</span> <span class="n">bigint</span>                    <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">target</span>       <span class="o">|</span> <span class="n">bigint</span>                    <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">cost</span>         <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">reverse_cost</span> <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">name</span>         <span class="o">|</span> <span class="n">text</span>                      <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">extended</span> <span class="o">|</span> 
 <span class="n">length</span>       <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">tag_id</span>       <span class="o">|</span> <span class="n">integer</span>                   <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">geom</span>         <span class="o">|</span> <span class="n">geometry</span><span class="p">(</span><span class="n">LineString</span><span class="p">,</span><span class="mi">4326</span><span class="p">)</span> <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">main</span>     <span class="o">|</span> 
<span class="n">View</span> <span class="n">definition</span><span class="p">:</span>
 <span class="n">WITH</span> <span class="n">all_components</span> <span class="n">AS</span> <span class="p">(</span>
         <span class="n">SELECT</span> <span class="n">ways_1</span><span class="o">.</span><span class="n">component</span><span class="p">,</span>
            <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">AS</span> <span class="n">count</span>
           <span class="n">FROM</span> <span class="n">ways</span> <span class="n">ways_1</span>
          <span class="n">GROUP</span> <span class="n">BY</span> <span class="n">ways_1</span><span class="o">.</span><span class="n">component</span>
        <span class="p">),</span> <span class="n">max_component</span> <span class="n">AS</span> <span class="p">(</span>
         <span class="n">SELECT</span> <span class="nb">max</span><span class="p">(</span><span class="n">all_components</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="n">AS</span> <span class="nb">max</span>
           <span class="n">FROM</span> <span class="n">all_components</span>
        <span class="p">),</span> <span class="n">the_component</span> <span class="n">AS</span> <span class="p">(</span>
         <span class="n">SELECT</span> <span class="n">all_components</span><span class="o">.</span><span class="n">component</span>
           <span class="n">FROM</span> <span class="n">all_components</span>
          <span class="n">WHERE</span> <span class="n">all_components</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="p">((</span> <span class="n">SELECT</span> <span class="n">max_component</span><span class="o">.</span><span class="n">max</span>
                   <span class="n">FROM</span> <span class="n">max_component</span><span class="p">))</span>
        <span class="p">)</span>
 <span class="n">SELECT</span> <span class="n">ways</span><span class="o">.</span><span class="n">gid</span> <span class="n">AS</span> <span class="nb">id</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">cost_s</span> <span class="n">AS</span> <span class="n">cost</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">reverse_cost_s</span> <span class="n">AS</span> <span class="n">reverse_cost</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">length_m</span> <span class="n">AS</span> <span class="n">length</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">tag_id</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">the_geom</span> <span class="n">AS</span> <span class="n">geom</span>
   <span class="n">FROM</span> <span class="n">ways</span>
     <span class="n">JOIN</span> <span class="n">the_component</span> <span class="n">USING</span> <span class="p">(</span><span class="n">component</span><span class="p">)</span>
     <span class="n">JOIN</span> <span class="n">configuration</span> <span class="n">USING</span> <span class="p">(</span><span class="n">tag_id</span><span class="p">)</span>
  <span class="n">WHERE</span> <span class="n">configuration</span><span class="o">.</span><span class="n">tag_value</span> <span class="o">&lt;&gt;</span> <span class="n">ALL</span> <span class="p">(</span><span class="n">ARRAY</span><span class="p">[</span><span class="s1">&#39;pedestrian&#39;</span><span class="p">::</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;steps&#39;</span><span class="p">::</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;footway&#39;</span><span class="p">::</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">::</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;cycleway&#39;</span><span class="p">::</span><span class="n">text</span><span class="p">]);</span>

</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-6-limiting-the-road-network-within-an-area">
<h3><a class="toc-backref" href="#id12" role="doc-backlink"><span class="section-number">2.5.2. </span>Övning 6: Begränsa vägnätet inom ett område</a><a class="headerlink" href="#exercise-6-limiting-the-road-network-within-an-area" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/taxi_net.png"><img alt="Vy över mindre uppsättning vägar för fordon" src="../_images/taxi_net.png" style="width: 371.5px; height: 217.25px;" />
</a>
<p class="rubric">Problem</p>
<ul class="simple">
<li><p>Skapa en vy <code class="docutils literal notranslate"><span class="pre">taxi_net</span></code> för <cite>taxi</cite>:</p>
<ul>
<li><p>The taxi can only circulate inside this Bounding Box: <code class="docutils literal notranslate"><span class="pre">(174.775,-36.855,174.76,-36.84)</span></code></p></li>
<li><p>Taxihastigheten är 10% slägre än för det aktuella fordonet.</p></li>
</ul>
</li>
<li><p>Verifiera det minskade antalet vägsegment.</p></li>
</ul>
<p class="rubric">Lösning</p>
<p>Skapa en vy:</p>
<ul class="simple">
<li><p>Justera taxins <code class="docutils literal notranslate"><span class="pre">cost</span></code> och <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code> så att de är 10% långsammare än för det aktuella fordonet. (rad <strong>7</strong>)</p></li>
<li><p>Grafen för taxin är en delmängd av grafen för <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code>. (rad <strong>9</strong>)</p></li>
<li><p>Can only circulate inside the bounding box:
<code class="docutils literal notranslate"><span class="pre">(174.775,-36.855,174.76,-36.84)</span></code>. (line <strong>10</strong>)</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- DROP VIEW taxi_net;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">taxi_net</span><span class="w"> </span><span class="k">AS</span>
<span class="w">    </span><span class="k">SELECT</span>
<span class="w">      </span><span class="n">id</span><span class="p">,</span>
<span class="w">      </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">,</span>
<span class="hll"><span class="w">      </span><span class="n">cost</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">10</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cost</span><span class="p">,</span><span class="w"> </span><span class="n">reverse_cost</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">10</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">reverse_cost</span><span class="p">,</span>
</span><span class="w">      </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">length</span><span class="p">,</span><span class="w"> </span><span class="n">tag_id</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span>
<span class="hll"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">vehicle_net</span>
</span><span class="hll"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">vehicle_net</span><span class="p">.</span><span class="n">geom</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ST_MakeEnvelope</span><span class="p">(</span><span class="mi">174</span><span class="p">.</span><span class="mi">775</span><span class="p">,</span><span class="o">-</span><span class="mi">36</span><span class="p">.</span><span class="mi">855</span><span class="p">,</span><span class="mi">174</span><span class="p">.</span><span class="mi">76</span><span class="p">,</span><span class="o">-</span><span class="mi">36</span><span class="p">.</span><span class="mi">84</span><span class="p">);</span>
</span></pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="da847709-d7a6-4213-ac10-f6f501925d84" name="da847709-d7a6-4213-ac10-f6f501925d84" type="checkbox"><label class="sphinx_collapse__label" for="da847709-d7a6-4213-ac10-f6f501925d84"><i class="sphinx_collapse__icon"></i>Response of command</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">VIEW</span>
</pre></div>
</div>
</div>
</div>
<p>Räkna raderna på <code class="docutils literal notranslate"><span class="pre">taxi_net</span></code>.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">taxi_net</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="95da68a9-88a8-4d7d-90cf-569e7a11bc1e" name="95da68a9-88a8-4d7d-90cf-569e7a11bc1e" type="checkbox"><label class="sphinx_collapse__label" for="95da68a9-88a8-4d7d-90cf-569e7a11bc1e"><i class="sphinx_collapse__icon"></i>Row count results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
  <span class="mi">2647</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p>Hämta beskrivningen.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">dS</span><span class="o">+</span> <span class="n">taxi_net</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="eca50c2e-3f89-4ce6-beca-973fd85f3989" name="eca50c2e-3f89-4ce6-beca-973fd85f3989" type="checkbox"><label class="sphinx_collapse__label" for="eca50c2e-3f89-4ce6-beca-973fd85f3989"><i class="sphinx_collapse__icon"></i>The view description</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                       <span class="n">View</span> <span class="s2">&quot;public.taxi_net&quot;</span>
    <span class="n">Column</span>    <span class="o">|</span>           <span class="n">Type</span>            <span class="o">|</span> <span class="n">Collation</span> <span class="o">|</span> <span class="n">Nullable</span> <span class="o">|</span> <span class="n">Default</span> <span class="o">|</span> <span class="n">Storage</span>  <span class="o">|</span> <span class="n">Description</span> 
<span class="o">--------------+---------------------------+-----------+----------+---------+----------+-------------</span>
 <span class="nb">id</span>           <span class="o">|</span> <span class="n">bigint</span>                    <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">source</span>       <span class="o">|</span> <span class="n">bigint</span>                    <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">target</span>       <span class="o">|</span> <span class="n">bigint</span>                    <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">cost</span>         <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">reverse_cost</span> <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">name</span>         <span class="o">|</span> <span class="n">text</span>                      <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">extended</span> <span class="o">|</span> 
 <span class="n">length</span>       <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">tag_id</span>       <span class="o">|</span> <span class="n">integer</span>                   <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">geom</span>         <span class="o">|</span> <span class="n">geometry</span><span class="p">(</span><span class="n">LineString</span><span class="p">,</span><span class="mi">4326</span><span class="p">)</span> <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">main</span>     <span class="o">|</span> 
<span class="n">View</span> <span class="n">definition</span><span class="p">:</span>
 <span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span>
    <span class="n">source</span><span class="p">,</span>
    <span class="n">target</span><span class="p">,</span>
    <span class="n">cost</span> <span class="o">*</span> <span class="mf">1.10</span><span class="p">::</span><span class="n">double</span> <span class="n">precision</span> <span class="n">AS</span> <span class="n">cost</span><span class="p">,</span>
    <span class="n">reverse_cost</span> <span class="o">*</span> <span class="mf">1.10</span><span class="p">::</span><span class="n">double</span> <span class="n">precision</span> <span class="n">AS</span> <span class="n">reverse_cost</span><span class="p">,</span>
    <span class="n">name</span><span class="p">,</span>
    <span class="n">length</span><span class="p">,</span>
    <span class="n">tag_id</span><span class="p">,</span>
    <span class="n">geom</span>
   <span class="n">FROM</span> <span class="n">vehicle_net</span>
  <span class="n">WHERE</span> <span class="n">geom</span> <span class="o">&amp;&amp;</span> <span class="n">st_makeenvelope</span><span class="p">(</span><span class="mf">174.775</span><span class="p">::</span><span class="n">double</span> <span class="n">precision</span><span class="p">,</span> <span class="s1">&#39;-36.855&#39;</span><span class="p">::</span><span class="n">numeric</span><span class="p">::</span><span class="n">double</span> <span class="n">precision</span><span class="p">,</span> <span class="mf">174.76</span><span class="p">::</span><span class="n">double</span> <span class="n">precision</span><span class="p">,</span> <span class="s1">&#39;-36.84&#39;</span><span class="p">::</span><span class="n">numeric</span><span class="p">::</span><span class="n">double</span> <span class="n">precision</span><span class="p">);</span>

</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-7-creating-a-materialized-view-for-routing-pedestrians">
<h3><a class="toc-backref" href="#id13" role="doc-backlink"><span class="section-number">2.5.3. </span>Övning 7: Skapa en materialiserad vy för att dirigera fotgängare</a><a class="headerlink" href="#exercise-7-creating-a-materialized-view-for-routing-pedestrians" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/walk_net.png"><img alt="Vy över vägar för fotgängare" src="../_images/walk_net.png" style="width: 368.75px; height: 215.75px;" />
</a>
<p class="rubric">Problem</p>
<ul class="simple">
<li><p>Skapa en materialiserad vy med minimal mängd information för bearbetning av fotgängare.</p></li>
<li><p>Routing <cite>cost</cite> och <cite>reverse_cost</cite> kommer att vara på sekunder för routingsberäkningar.</p>
<ul>
<li><p>Hastigheten är <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">mts/sek</span></code>.</p></li>
</ul>
</li>
<li><p>Only include the pedestrian only roads: <code class="docutils literal notranslate"><span class="pre">pedestrian</span></code>, <code class="docutils literal notranslate"><span class="pre">steps</span></code>, <code class="docutils literal notranslate"><span class="pre">footway</span></code>,
<code class="docutils literal notranslate"><span class="pre">path</span></code>, <code class="docutils literal notranslate"><span class="pre">cycleway</span></code></p></li>
<li><p>Data som behövs i vyn för vidare bearbetning.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">length_m</span></code> The length in meters.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">the_geom</span></code> The geometry.</p></li>
</ul>
</li>
<li><p>Kontrollera att antalet kanter har minskats.</p></li>
</ul>
<p class="rubric">Lösning</p>
<ul class="simple">
<li><p>Skapa en vy:</p>
<ul>
<li><p>Liknar <a class="reference internal" href="#exercise-5-creating-a-view-for-routing">Övning 5: Skapa en vy för routing</a>:</p>
<ul>
<li><p>Kostnaden och den omvända kostnaden anges i sekunder med en hastighet av 2 mts/sek. (rad <strong>7</strong>)</p></li>
<li><p>Exclude <code class="docutils literal notranslate"><span class="pre">motorway</span></code>, <code class="docutils literal notranslate"><span class="pre">primary</span></code> and <code class="docutils literal notranslate"><span class="pre">secondary</span></code> . (line <strong>11</strong>)</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- DROP MATERIALIZED VIEW walk_net CASCADE;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="n">MATERIALIZED</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">walk_net</span><span class="w"> </span><span class="k">AS</span>

<span class="k">WITH</span>
<span class="n">allc</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">component</span><span class="p">),</span>
<span class="hll"><span class="n">maxcount</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="k">count</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">allc</span><span class="p">),</span>
</span><span class="n">the_component</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">allc</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">max</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">maxcount</span><span class="p">))</span>

<span class="k">SELECT</span>
<span class="hll"><span class="w">  </span><span class="n">gid</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
</span><span class="w">  </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">,</span>
<span class="w">  </span><span class="n">length_m</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cost</span><span class="p">,</span><span class="w"> </span><span class="n">length_m</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">reverse_cost</span><span class="p">,</span>
<span class="w">  </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">length_m</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">length</span><span class="p">,</span><span class="w"> </span><span class="n">the_geom</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">geom</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">the_component</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">component</span><span class="p">)</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">tag_id</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w">  </span><span class="n">tag_value</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;pedestrian&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;steps&#39;</span><span class="p">,</span><span class="s1">&#39;footway&#39;</span><span class="p">,</span><span class="s1">&#39;path&#39;</span><span class="p">,</span><span class="s1">&#39;cycleway&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">-- line 18</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="f3356e15-44be-413c-99d0-818fc1102c61" name="f3356e15-44be-413c-99d0-818fc1102c61" type="checkbox"><label class="sphinx_collapse__label" for="f3356e15-44be-413c-99d0-818fc1102c61"><i class="sphinx_collapse__icon"></i>Response of command</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="mi">20104</span>
</pre></div>
</div>
</div>
</div>
<p>Räkna raderna på vyn <code class="docutils literal notranslate"><span class="pre">walk_net</span></code>.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">walk_net</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="c32fb94c-cc11-42bc-931d-a7a1dbbf89f8" name="c32fb94c-cc11-42bc-931d-a7a1dbbf89f8" type="checkbox"><label class="sphinx_collapse__label" for="c32fb94c-cc11-42bc-931d-a7a1dbbf89f8"><i class="sphinx_collapse__icon"></i>Row count results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
 <span class="mi">20104</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p>Hämta beskrivningen.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">dS</span><span class="o">+</span> <span class="n">walk_net</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="2ce9cc2f-0102-4f76-a2b9-e2ddb2dfc184" name="2ce9cc2f-0102-4f76-a2b9-e2ddb2dfc184" type="checkbox"><label class="sphinx_collapse__label" for="2ce9cc2f-0102-4f76-a2b9-e2ddb2dfc184"><i class="sphinx_collapse__icon"></i>The view description</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                               <span class="n">Materialized</span> <span class="n">view</span> <span class="s2">&quot;public.walk_net&quot;</span>
    <span class="n">Column</span>    <span class="o">|</span>           <span class="n">Type</span>            <span class="o">|</span> <span class="n">Collation</span> <span class="o">|</span> <span class="n">Nullable</span> <span class="o">|</span> <span class="n">Default</span> <span class="o">|</span> <span class="n">Storage</span>  <span class="o">|</span> <span class="n">Compression</span> <span class="o">|</span> <span class="n">Stats</span> <span class="n">target</span> <span class="o">|</span> <span class="n">Description</span> 
<span class="o">--------------+---------------------------+-----------+----------+---------+----------+-------------+--------------+-------------</span>
 <span class="nb">id</span>           <span class="o">|</span> <span class="n">bigint</span>                    <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">source</span>       <span class="o">|</span> <span class="n">bigint</span>                    <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">target</span>       <span class="o">|</span> <span class="n">bigint</span>                    <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">cost</span>         <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">reverse_cost</span> <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">name</span>         <span class="o">|</span> <span class="n">text</span>                      <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">extended</span> <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">length</span>       <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">geom</span>         <span class="o">|</span> <span class="n">geometry</span><span class="p">(</span><span class="n">LineString</span><span class="p">,</span><span class="mi">4326</span><span class="p">)</span> <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">main</span>     <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
<span class="n">View</span> <span class="n">definition</span><span class="p">:</span>
 <span class="n">WITH</span> <span class="n">allc</span> <span class="n">AS</span> <span class="p">(</span>
         <span class="n">SELECT</span> <span class="n">ways_1</span><span class="o">.</span><span class="n">component</span><span class="p">,</span>
            <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">AS</span> <span class="n">count</span>
           <span class="n">FROM</span> <span class="n">ways</span> <span class="n">ways_1</span>
          <span class="n">GROUP</span> <span class="n">BY</span> <span class="n">ways_1</span><span class="o">.</span><span class="n">component</span>
        <span class="p">),</span> <span class="n">maxcount</span> <span class="n">AS</span> <span class="p">(</span>
         <span class="n">SELECT</span> <span class="nb">max</span><span class="p">(</span><span class="n">allc</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="n">AS</span> <span class="nb">max</span>
           <span class="n">FROM</span> <span class="n">allc</span>
        <span class="p">),</span> <span class="n">the_component</span> <span class="n">AS</span> <span class="p">(</span>
         <span class="n">SELECT</span> <span class="n">allc</span><span class="o">.</span><span class="n">component</span>
           <span class="n">FROM</span> <span class="n">allc</span>
          <span class="n">WHERE</span> <span class="n">allc</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="p">((</span> <span class="n">SELECT</span> <span class="n">maxcount</span><span class="o">.</span><span class="n">max</span>
                   <span class="n">FROM</span> <span class="n">maxcount</span><span class="p">))</span>
        <span class="p">)</span>
 <span class="n">SELECT</span> <span class="n">ways</span><span class="o">.</span><span class="n">gid</span> <span class="n">AS</span> <span class="nb">id</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">length_m</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">::</span><span class="n">double</span> <span class="n">precision</span> <span class="n">AS</span> <span class="n">cost</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">length_m</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">::</span><span class="n">double</span> <span class="n">precision</span> <span class="n">AS</span> <span class="n">reverse_cost</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">length_m</span> <span class="n">AS</span> <span class="n">length</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">the_geom</span> <span class="n">AS</span> <span class="n">geom</span>
   <span class="n">FROM</span> <span class="n">ways</span>
     <span class="n">JOIN</span> <span class="n">the_component</span> <span class="n">USING</span> <span class="p">(</span><span class="n">component</span><span class="p">)</span>
     <span class="n">JOIN</span> <span class="n">configuration</span> <span class="n">USING</span> <span class="p">(</span><span class="n">tag_id</span><span class="p">)</span>
  <span class="n">WHERE</span> <span class="n">configuration</span><span class="o">.</span><span class="n">tag_value</span> <span class="o">=</span> <span class="n">ANY</span> <span class="p">(</span><span class="n">ARRAY</span><span class="p">[</span><span class="s1">&#39;pedestrian&#39;</span><span class="p">::</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;steps&#39;</span><span class="p">::</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;footway&#39;</span><span class="p">::</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">::</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;cycleway&#39;</span><span class="p">::</span><span class="n">text</span><span class="p">]);</span>
<span class="n">Access</span> <span class="n">method</span><span class="p">:</span> <span class="n">heap</span>

</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="pgr-dijkstracostmatrix">
<h2><a class="toc-backref" href="#id14" role="doc-backlink"><span class="section-number">2.6. </span>pgr_dijkstraCostMatrix</a><a class="headerlink" href="#pgr-dijkstracostmatrix" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">pgr_dijkstraCostMatrix</span></code> Calculates a cost matrix using Dijkstra algorithm.</p>
<p class="rubric">Sammanfattning av signatur</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">pgr_dijkstraCostMatrix</span><span class="p">(</span><span class="n">Edges</span><span class="w"> </span><span class="k">SQL</span><span class="p">,</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="n">vids</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">directed</span><span class="p">])</span>

<span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="p">(</span><span class="n">start_vid</span><span class="p">,</span><span class="w"> </span><span class="n">end_vid</span><span class="p">,</span><span class="w"> </span><span class="n">agg_cost</span><span class="p">)</span>
<span class="k">OR</span><span class="w"> </span><span class="n">EMPTY</span><span class="w"> </span><span class="k">SET</span>
</pre></div>
</div>
<p>Description of the function can be found in <a class="reference external" href="https://docs.pgrouting.org/latest/en/pgr_dijkstraCostMatrix.html">pgr_dijkstraCostMatrix</a></p>
<section id="exercise-8-testing-the-views">
<h3><a class="toc-backref" href="#id15" role="doc-backlink"><span class="section-number">2.6.1. </span>Exercise 8: Testing the views</a><a class="headerlink" href="#exercise-8-testing-the-views" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/costMatrix.png"><img alt="../_images/costMatrix.png" src="../_images/costMatrix.png" style="width: 368.75px; height: 215.75px;" />
</a>
<p class="rubric">Problem</p>
<ul class="simple">
<li><p>Testa de skapade vyerna</p></li>
</ul>
<p>I synnerhet:</p>
<ul class="simple">
<li><p>Get a traveling cost matrix in seconds from all locations to all locations.</p></li>
<li><p>de åsikter som ska testas är:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">taxi_net</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">walk_net</span></code></p></li>
</ul>
</li>
</ul>
<p class="rubric">Lösning</p>
<ul class="simple">
<li><p>The locations are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">10840</span></code>, <code class="docutils literal notranslate"><span class="pre">936</span></code>, <code class="docutils literal notranslate"><span class="pre">21570</span></code>, <code class="docutils literal notranslate"><span class="pre">10928</span></code> and <code class="docutils literal notranslate"><span class="pre">12777</span></code>.</p></li>
<li><p>Passed as an array to the function.</p></li>
</ul>
</li>
</ul>
<p>För <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code> används.</p></li>
<li><p>Val av kolumner med motsvarande namn finns på rad <strong>1</strong>.</p></li>
<li><p>Vyn är förberedd med de kolumnnamn som pgRouting använder.</p>
<ul>
<li><p>Det finns inget behov av att byta namn på kolumner. (rad <strong>3</strong>)</p></li>
</ul>
</li>
<li><p>OSM-identifierarna för avgång och destination används. (rad <strong>4</strong>)</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="linenos">1</span><span class="k">SELECT</span><span class="w"> </span><span class="n">start_vid</span><span class="p">,</span><span class="w"> </span><span class="n">end_vid</span><span class="p">,</span><span class="w"> </span><span class="n">agg_cost</span>
</span><span class="linenos">2</span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstraCostMatrix</span><span class="p">(</span>
<span class="hll"><span class="linenos">3</span><span class="w">  </span><span class="s1">&#39;SELECT * FROM vehicle_net&#39;</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">4</span><span class="w">  </span><span class="nb">ARRAY</span><span class="p">[</span><span class="mi">10840</span><span class="p">,</span><span class="w"> </span><span class="mi">936</span><span class="p">,</span><span class="w"> </span><span class="mi">21570</span><span class="p">,</span><span class="w"> </span><span class="mi">10928</span><span class="p">,</span><span class="w"> </span><span class="mi">12777</span><span class="p">]);</span>
</span></pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="2111222b-5571-4d0e-801b-cb02a6d854af" name="2111222b-5571-4d0e-801b-cb02a6d854af" type="checkbox"><label class="sphinx_collapse__label" for="2111222b-5571-4d0e-801b-cb02a6d854af"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">start_vid</span> <span class="o">|</span> <span class="n">end_vid</span> <span class="o">|</span>      <span class="n">agg_cost</span>      
<span class="o">-----------+---------+--------------------</span>
     <span class="mi">10840</span> <span class="o">|</span>   <span class="mi">10928</span> <span class="o">|</span>  <span class="mf">92.62169923516363</span>
     <span class="mi">10840</span> <span class="o">|</span>   <span class="mi">12777</span> <span class="o">|</span> <span class="mf">131.97395454563156</span>
     <span class="mi">10840</span> <span class="o">|</span>   <span class="mi">21570</span> <span class="o">|</span>   <span class="mf">48.0208391902059</span>
     <span class="mi">10928</span> <span class="o">|</span>   <span class="mi">10840</span> <span class="o">|</span>  <span class="mf">150.3076263447858</span>
     <span class="mi">10928</span> <span class="o">|</span>   <span class="mi">12777</span> <span class="o">|</span> <span class="mf">135.12540835351246</span>
     <span class="mi">10928</span> <span class="o">|</span>   <span class="mi">21570</span> <span class="o">|</span>  <span class="mf">98.47283483371632</span>
     <span class="mi">12777</span> <span class="o">|</span>   <span class="mi">10840</span> <span class="o">|</span> <span class="mf">139.79811678810356</span>
     <span class="mi">12777</span> <span class="o">|</span>   <span class="mi">10928</span> <span class="o">|</span> <span class="mf">110.69672228339044</span>
     <span class="mi">12777</span> <span class="o">|</span>   <span class="mi">21570</span> <span class="o">|</span> <span class="mf">155.38263515775233</span>
     <span class="mi">21570</span> <span class="o">|</span>   <span class="mi">10840</span> <span class="o">|</span>  <span class="mf">80.99982055010783</span>
     <span class="mi">21570</span> <span class="o">|</span>   <span class="mi">10928</span> <span class="o">|</span> <span class="mf">107.12136717821703</span>
     <span class="mi">21570</span> <span class="o">|</span>   <span class="mi">12777</span> <span class="o">|</span>  <span class="mf">157.0795377408708</span>
<span class="p">(</span><span class="mi">12</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p>För <code class="docutils literal notranslate"><span class="pre">taxi_net</span></code>:</p>
<ul class="simple">
<li><p>Liknande som den föregående men med <code class="docutils literal notranslate"><span class="pre">taxi_net</span></code>. (rad <strong>3</strong>)</p></li>
<li><p>Resultatet ger samma rutt som med <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code> men <code class="docutils literal notranslate"><span class="pre">cost</span></code> är högre.</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">start_vid</span><span class="p">,</span><span class="w"> </span><span class="n">end_vid</span><span class="p">,</span><span class="w"> </span><span class="n">agg_cost</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstraCostMatrix</span><span class="p">(</span>
<span class="hll"><span class="w">  </span><span class="s1">&#39;SELECT * FROM taxi_net&#39;</span><span class="p">,</span>
</span><span class="w">  </span><span class="nb">ARRAY</span><span class="p">[</span><span class="mi">10840</span><span class="p">,</span><span class="w"> </span><span class="mi">936</span><span class="p">,</span><span class="w"> </span><span class="mi">21570</span><span class="p">,</span><span class="w"> </span><span class="mi">10928</span><span class="p">,</span><span class="w"> </span><span class="mi">12777</span><span class="p">]);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="e5abaa3f-8533-4830-a861-d6a4793c9402" name="e5abaa3f-8533-4830-a861-d6a4793c9402" type="checkbox"><label class="sphinx_collapse__label" for="e5abaa3f-8533-4830-a861-d6a4793c9402"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">start_vid</span> <span class="o">|</span> <span class="n">end_vid</span> <span class="o">|</span>      <span class="n">agg_cost</span>      
<span class="o">-----------+---------+--------------------</span>
     <span class="mi">10840</span> <span class="o">|</span>   <span class="mi">10928</span> <span class="o">|</span> <span class="mf">101.88386915868001</span>
     <span class="mi">10840</span> <span class="o">|</span>   <span class="mi">12777</span> <span class="o">|</span> <span class="mf">145.17135000019474</span>
     <span class="mi">10840</span> <span class="o">|</span>   <span class="mi">21570</span> <span class="o">|</span> <span class="mf">52.822923109226494</span>
     <span class="mi">10928</span> <span class="o">|</span>   <span class="mi">10840</span> <span class="o">|</span> <span class="mf">165.33838897926447</span>
     <span class="mi">10928</span> <span class="o">|</span>   <span class="mi">12777</span> <span class="o">|</span>  <span class="mf">148.6379491888637</span>
     <span class="mi">10928</span> <span class="o">|</span>   <span class="mi">21570</span> <span class="o">|</span> <span class="mf">108.32011831708796</span>
     <span class="mi">12777</span> <span class="o">|</span>   <span class="mi">10840</span> <span class="o">|</span> <span class="mf">153.77792846691395</span>
     <span class="mi">12777</span> <span class="o">|</span>   <span class="mi">10928</span> <span class="o">|</span> <span class="mf">121.76639451172952</span>
     <span class="mi">12777</span> <span class="o">|</span>   <span class="mi">21570</span> <span class="o">|</span> <span class="mf">170.92089867352766</span>
     <span class="mi">21570</span> <span class="o">|</span>   <span class="mi">10840</span> <span class="o">|</span>   <span class="mf">89.0998026051186</span>
     <span class="mi">21570</span> <span class="o">|</span>   <span class="mi">10928</span> <span class="o">|</span> <span class="mf">117.83350389603875</span>
     <span class="mi">21570</span> <span class="o">|</span>   <span class="mi">12777</span> <span class="o">|</span> <span class="mf">172.78749151495796</span>
<span class="p">(</span><span class="mi">12</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p>För <code class="docutils literal notranslate"><span class="pre">walk_net</span></code>:</p>
<ul>
<li><p>Liknande som den föregående men med <code class="docutils literal notranslate"><span class="pre">walk_net</span></code>. (rad <strong>3</strong>)</p></li>
<li><p>Resultaten ger en annan rutt än fordonens.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">start_vid</span><span class="p">,</span><span class="w"> </span><span class="n">end_vid</span><span class="p">,</span><span class="w"> </span><span class="n">agg_cost</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstraCostMatrix</span><span class="p">(</span>
<span class="hll"><span class="w">  </span><span class="s1">&#39;SELECT * FROM walk_net&#39;</span><span class="p">,</span>
</span><span class="w">  </span><span class="nb">ARRAY</span><span class="p">[</span><span class="mi">10840</span><span class="p">,</span><span class="w"> </span><span class="mi">936</span><span class="p">,</span><span class="w"> </span><span class="mi">21570</span><span class="p">,</span><span class="w"> </span><span class="mi">10928</span><span class="p">,</span><span class="w"> </span><span class="mi">12777</span><span class="p">]);</span>
</pre></div>
</div>
</li>
</ul>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="721a555a-c483-42ec-b3fa-23dedd18df47" name="721a555a-c483-42ec-b3fa-23dedd18df47" type="checkbox"><label class="sphinx_collapse__label" for="721a555a-c483-42ec-b3fa-23dedd18df47"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">start_vid</span> <span class="o">|</span> <span class="n">end_vid</span> <span class="o">|</span>      <span class="n">agg_cost</span>      
<span class="o">-----------+---------+--------------------</span>
       <span class="mi">936</span> <span class="o">|</span>   <span class="mi">10840</span> <span class="o">|</span>  <span class="mf">103.6184909456129</span>
       <span class="mi">936</span> <span class="o">|</span>   <span class="mi">10928</span> <span class="o">|</span>  <span class="mf">358.8563418735532</span>
       <span class="mi">936</span> <span class="o">|</span>   <span class="mi">12777</span> <span class="o">|</span>  <span class="mf">352.5086163914612</span>
       <span class="mi">936</span> <span class="o">|</span>   <span class="mi">21570</span> <span class="o">|</span> <span class="mf">250.65059710078583</span>
     <span class="mi">10840</span> <span class="o">|</span>     <span class="mi">936</span> <span class="o">|</span>  <span class="mf">103.6184909456129</span>
     <span class="mi">10840</span> <span class="o">|</span>   <span class="mi">10928</span> <span class="o">|</span>  <span class="mf">383.0827019759325</span>
     <span class="mi">10840</span> <span class="o">|</span>   <span class="mi">12777</span> <span class="o">|</span>  <span class="mf">423.0334523034633</span>
     <span class="mi">10840</span> <span class="o">|</span>   <span class="mi">21570</span> <span class="o">|</span> <span class="mf">192.28099914894182</span>
     <span class="mi">10928</span> <span class="o">|</span>     <span class="mi">936</span> <span class="o">|</span>  <span class="mf">358.8563418735532</span>
     <span class="mi">10928</span> <span class="o">|</span>   <span class="mi">10840</span> <span class="o">|</span>  <span class="mf">383.0827019759326</span>
     <span class="mi">10928</span> <span class="o">|</span>   <span class="mi">12777</span> <span class="o">|</span> <span class="mf">464.75653800007507</span>
     <span class="mi">10928</span> <span class="o">|</span>   <span class="mi">21570</span> <span class="o">|</span> <span class="mf">414.39918676018954</span>
     <span class="mi">12777</span> <span class="o">|</span>     <span class="mi">936</span> <span class="o">|</span>  <span class="mf">352.5086163914611</span>
     <span class="mi">12777</span> <span class="o">|</span>   <span class="mi">10840</span> <span class="o">|</span> <span class="mf">423.03345230346326</span>
     <span class="mi">12777</span> <span class="o">|</span>   <span class="mi">10928</span> <span class="o">|</span> <span class="mf">464.75653800007495</span>
     <span class="mi">12777</span> <span class="o">|</span>   <span class="mi">21570</span> <span class="o">|</span>  <span class="mf">563.5749907754648</span>
     <span class="mi">21570</span> <span class="o">|</span>     <span class="mi">936</span> <span class="o">|</span>  <span class="mf">250.6505971007858</span>
     <span class="mi">21570</span> <span class="o">|</span>   <span class="mi">10840</span> <span class="o">|</span> <span class="mf">192.28099914894173</span>
     <span class="mi">21570</span> <span class="o">|</span>   <span class="mi">10928</span> <span class="o">|</span> <span class="mf">414.39918676018937</span>
     <span class="mi">21570</span> <span class="o">|</span>   <span class="mi">12777</span> <span class="o">|</span>   <span class="mf">563.574990775465</span>
<span class="p">(</span><span class="mi">20</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2010-2025 pgRouting Developers.<br/>
      Senast uppdaterad okt. 07, 2025.<br/>
    </p>
  </div>
</footer>
  </body>
</html>