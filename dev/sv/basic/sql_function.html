<!DOCTYPE html>

<html lang="sv" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5. SQL-funktion &#8212; Workshop - FOSS4G Auckland - Routing with pgRouting</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=5a695559" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css?v=226d88b4" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=fa3951f0" />
    <script src="../_static/documentation_options.js?v=b616604d"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/translations.js?v=55d7b627"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="search" title="Sök" href="../search.html" />
    <link rel="next" title="6. Routing using points" href="withPoints.html" />
    <link rel="prev" title="4. Routning av fordon" href="vehicle.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="../index.html">
          Workshop FOSS4G Auckland</a>
        <span class="navbar-text pull-left"><b>3.1</b></span>

        <div class="nav-collapse">
          <ul class="nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://docs.pgrouting.org/latest/en/index.html">Documentation</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Chapters <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/introduction.html">1. Introduktion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/osgeolive.html">2. OSGeoLive-installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/overview.html">3. Översikt över programvara och data</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data.html">1. Förbereda data</a></li>
<li class="toctree-l1"><a class="reference internal" href="graphs.html">2. Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="pedestrian.html">3. Routning av fotgängare</a></li>
<li class="toctree-l1"><a class="reference internal" href="vehicle.html">4. Routning av fordon</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. SQL-funktion</a></li>
<li class="toctree-l1"><a class="reference internal" href="withPoints.html">6. Routing using points</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/data.html">1. Data för målen för hållbar utveckling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/introduction.html">2. Uppnå målen för hållbar utveckling med pgRouting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/sdg3-health.html">3. God hälsa och välbefinnande</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/sdg7-energy.html">4. Prisvärd och ren energi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/sdg11-cities.html">5. Hållbara städer och samhällen</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-9.html">1. Använda Qgis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-10.html">2. WMS-server med GeoServer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-11.html">3. OpenLayers-baserat gränssnitt för routning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/chapter-12.html">4. Skapa en nätverkstopologi</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/boost_dijkstra.html">1. Dijkstra-exempel med Boost</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/hanoslav.html">2. Exempel från internet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/wiki_example.html">3. Dijkstra-exempel från Wikipedia</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-2.html">1. Bilaga: Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-3.html">2. Bilaga: Importverktyg för osm2pgrouting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-4.html">3. Videohandledningar för workshop</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">5. SQL-funktion</a><ul>
<li><a class="reference internal" href="#the-function-requirements">5.1. The function requirements</a></li>
<li><a class="reference internal" href="#additional-information-handling">5.2. Hantering av ytterligare information</a><ul>
<li><a class="reference internal" href="#exercise-1-get-additional-information">5.2.1. Övning 1: Skaffa ytterligare information</a></li>
</ul>
</li>
<li><a class="reference internal" href="#geometry-handling">5.3. Geometrihantering</a><ul>
<li><a class="reference internal" href="#exercise-2-route-geometry-human-readable">5.3.1. Övning 2: Geometri för rutt (läsbar för människor)</a></li>
<li><a class="reference internal" href="#exercise-3-route-geometry-binary-format">5.3.2. Övning 3: Ruttgeometri (binärt format)</a></li>
<li><a class="reference internal" href="#exercise-4-route-geometry-directionality">5.3.3. Övning 4: Riktning för väggeometri</a></li>
<li><a class="reference internal" href="#exercise-5-using-the-geometry">5.3.4. Övning 5: Använda geometrin</a></li>
<li><a class="reference internal" href="#exercise-6-using-the-function">5.3.5. Exercise 6: Using the function</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="vehicle.html" title="Previous Chapter: 4. Routning av fordon"><span class="icon-chevron-left visible-tablet"></span><span class="hidden-sm hidden-tablet">&laquo; 4. Routning av fordon</span>
    </a>
  </li>
  <li>
    <a href="withPoints.html" title="Next Chapter: 6. Routing using points"><span class="icon-chevron-right visible-tablet"></span><span class="hidden-sm hidden-tablet">6. Routing us... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
      </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body span12 content" role="main">
      
  <section id="sql-function">
<h1><a class="toc-backref" href="#id17" role="doc-backlink"><span class="section-number">5. </span>SQL-funktion</a><a class="headerlink" href="#sql-function" title="Link to this heading">¶</a></h1>
<a class="reference internal image-reference" href="../_images/sql_route_names.png"><img alt="../_images/sql_route_names.png" class="align-center" src="../_images/sql_route_names.png" style="width: 373.0px; height: 218.75px;" />
</a>
<nav class="contents" id="chapter-contents">
<p class="topic-title">Kapitelinnehåll</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sql-function" id="id17">SQL-funktion</a></p>
<ul>
<li><p><a class="reference internal" href="#the-function-requirements" id="id18">The function requirements</a></p></li>
<li><p><a class="reference internal" href="#additional-information-handling" id="id19">Hantering av ytterligare information</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-1-get-additional-information" id="id20">Övning 1: Skaffa ytterligare information</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#geometry-handling" id="id21">Geometrihantering</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-2-route-geometry-human-readable" id="id22">Övning 2: Geometri för rutt (läsbar för människor)</a></p></li>
<li><p><a class="reference internal" href="#exercise-3-route-geometry-binary-format" id="id23">Övning 3: Ruttgeometri (binärt format)</a></p></li>
<li><p><a class="reference internal" href="#exercise-4-route-geometry-directionality" id="id24">Övning 4: Riktning för väggeometri</a></p></li>
<li><p><a class="reference internal" href="#exercise-5-using-the-geometry" id="id25">Övning 5: Använda geometrin</a></p></li>
<li><p><a class="reference internal" href="#exercise-6-using-the-function" id="id26">Exercise 6: Using the function</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<p>pgRouting-funktioner ger ett gränssnitt på ”låg nivå”.</p>
<p>När du utvecklar för en applikation på ”högre nivå” måste kraven representeras i SQL-frågorna. Eftersom dessa SQL-frågor blir mer komplexa är det önskvärt att lagra dem i postgreSQL-lagrade procedurer eller funktioner. Lagrade procedurer eller funktioner är ett effektivt sätt att linda in applikationslogik, i det här fallet relaterat till routinglogik och krav.</p>
<section id="the-function-requirements">
<h2><a class="toc-backref" href="#id18" role="doc-backlink"><span class="section-number">5.1. </span>The function requirements</a><a class="headerlink" href="#the-function-requirements" title="Link to this heading">¶</a></h2>
<p>The function will wrap <code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code>.</p>
<p>The function needs to work on any of the networks designed:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">taxi_net</span></code></p></li>
</ul>
<p>The function needs to return the following routing information:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">seq</span></code> - En unik identifierare av raderna</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code> - Segmentets identifierare</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> - Segmentets namn</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">length</span></code> - Segmentets längd</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seconds</span></code> - Antal sekunder för att korsa segmentet</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">azimuth</span></code> - Segmentets azimut</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">route_geom</span></code> - Routinggeometrin</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">route_readable</span></code> - Geometrin i läsbar form för människor.</p></li>
</ul>
<p class="rubric">Utformning av funktionen</p>
<p>Den funktion som skall skapas är <code class="docutils literal notranslate"><span class="pre">wrk_dijkstra</span></code> med följande inparametrar och utdatakolumner:</p>
<p class="rubric">Parametrar för inmatning</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Typ</p></th>
<th class="head"><p>Beskrivning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">edges_subset</span></code></p></td>
<td><p>REGCLASS</p></td>
<td><p>Den tabell/vy som kommer att användas för bearbetning</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">source</span></code></p></td>
<td><p>BIGINT</p></td>
<td><p>The  identifier of the <cite>departure</cite> location.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">target</span></code></p></td>
<td><p>BIGINT</p></td>
<td><p>The  identifier of the <cite>destination</cite> location.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">utmatningskolumner</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Namn</p></th>
<th class="head"><p>Typ</p></th>
<th class="head"><p>Beskrivning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">seq</span></code></p></td>
<td><p>HELTAL</p></td>
<td><p>Ett unikt nummer för varje resultatrad.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>BIGINT</p></td>
<td><p>Identifieraren för kanten.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">name</span></code></p></td>
<td><p>TEXT</p></td>
<td><p>Namnet på segmentet.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">seconds</span></code></p></td>
<td><p>FLOAT</p></td>
<td><p>Antal sekunder det tar att korsa segmentet.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">length</span></code></p></td>
<td><p>FLOAT</p></td>
<td><p>Segmentets längd i meter.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">azimuth</span></code></p></td>
<td><p>FLOAT</p></td>
<td><p>Segmentets azimut.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">route_readable</span></code></p></td>
<td><p>TEXT</p></td>
<td><p>Geometrin i mänskligt läsbar form.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">route_geom</span></code></p></td>
<td><p>geometri</p></td>
<td><p>Segmentets geometri i rätt riktning.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="additional-information-handling">
<h2><a class="toc-backref" href="#id19" role="doc-backlink"><span class="section-number">5.2. </span>Hantering av ytterligare information</a><a class="headerlink" href="#additional-information-handling" title="Link to this heading">¶</a></h2>
<p>När programmet behöver ytterligare information, t.ex. gatunamnet, kan du ”koppla ihop” resultaten med andra tabeller.</p>
<section id="exercise-1-get-additional-information">
<h3><a class="toc-backref" href="#id20" role="doc-backlink"><span class="section-number">5.2.1. </span>Övning 1: Skaffa ytterligare information</a><a class="headerlink" href="#exercise-1-get-additional-information" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/sql_route_names.png"><img alt="Namn på vägvisning" src="../_images/sql_route_names.png" style="width: 300pt;" />
</a>
<p class="rubric">Problem</p>
<ul class="simple">
<li><p>Från Emily Place Reserve till Auckland University of Technology</p></li>
<li><p>Få följande information:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">seq</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seconds</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">length</span></code></p></li>
</ul>
</li>
</ul>
<p class="rubric">Lösning</p>
<ul class="simple">
<li><p>The function returns the columns asked. (line <strong>4</strong>)</p></li>
<li><p>Rename <code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code> results to application requirements names. (line
<strong>12</strong>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LEFT</span> <span class="pre">JOIN</span></code> the results with <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code> to get the additional
information. (line <strong>17</strong>)</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">LEFT</span></code> att inkludera raden med <code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">=</span> <span class="pre">-1</span></code> eftersom den inte finns på <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code></p></li>
</ul>
</li>
<li><p>Test from <a href="#id1"><span class="problematic" id="id2">|ch7_id_1|</span></a> to <a href="#id3"><span class="problematic" id="id4">|ch7_id_2|</span></a> on <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code>. (Last line)</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">-- DROP FUNCTION wrk_dijkstra(regclass, bigint, bigint);</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span>
<span class="hll"><span class="linenos"> 4</span><span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">edges_subset</span><span class="w"> </span><span class="n">REGCLASS</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
</span><span class="linenos"> 5</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="k">length</span><span class="w"> </span><span class="nb">FLOAT</span>
<span class="linenos"> 6</span><span class="p">)</span>
<span class="linenos"> 7</span><span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="k">AS</span>
<span class="linenos"> 8</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos"> 9</span><span class="k">SELECT</span>
<span class="linenos">10</span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">length</span>
<span class="linenos">11</span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="hll"><span class="linenos">12</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">seconds</span>
</span><span class="linenos">13</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstra</span><span class="p">(</span>
<span class="linenos">14</span><span class="w">    </span><span class="s1">&#39;SELECT * FROM &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">15</span><span class="w">    </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">)</span>
<span class="linenos">16</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">results</span>
<span class="hll"><span class="linenos">17</span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vehicle_net</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
</span><span class="linenos">18</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span>
<span class="linenos">19</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">20</span><span class="k">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="p">;</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="9e685d5b-7bb4-43b8-a74e-08ddae529d8e" name="9e685d5b-7bb4-43b8-a74e-08ddae529d8e" type="checkbox"><label class="sphinx_collapse__label" for="9e685d5b-7bb4-43b8-a74e-08ddae529d8e"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">FUNCTION</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="geometry-handling">
<h2><a class="toc-backref" href="#id21" role="doc-backlink"><span class="section-number">5.3. </span>Geometrihantering</a><a class="headerlink" href="#geometry-handling" title="Link to this heading">¶</a></h2>
<p>Ur pgRoutings synvinkel är geometrin en del av den ytterligare information som behövs om resultaten för en applikation. Därför <code class="docutils literal notranslate"><span class="pre">JOIN</span></code> resultaten med andra tabeller som innehåller geometrin och för vidare bearbetning med PostGIS-funktioner.</p>
<section id="exercise-2-route-geometry-human-readable">
<h3><a class="toc-backref" href="#id22" role="doc-backlink"><span class="section-number">5.3.1. </span>Övning 2: Geometri för rutt (läsbar för människor)</a><a class="headerlink" href="#exercise-2-route-geometry-human-readable" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/sql_route_readable.png"><img alt="Från |ch7_place_1| till |ch7_place_2|" src="../_images/sql_route_readable.png" style="width: 300pt;" />
</a>
<p class="rubric">Problem</p>
<p>Rutt från Emily Place Reserve till Auckland University of Technology</p>
<ul class="simple">
<li><p>Utöver den föregående övningen, skaffa</p>
<ul>
<li><p>geometri <code class="docutils literal notranslate"><span class="pre">geom</span></code> i mänskligt läsbar form benämnd <code class="docutils literal notranslate"><span class="pre">route_readable</span></code></p></li>
</ul>
</li>
</ul>
<p class="rubric">Lösning</p>
<ul class="simple">
<li><p>The function returns <code class="docutils literal notranslate"><span class="pre">route_readable</span></code>. (line <strong>6</strong>)</p></li>
<li><p>The routing query named <code class="docutils literal notranslate"><span class="pre">results</span></code> in a WITH clause. (line <strong>11</strong>)</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">geom</span></code> processed with <code class="docutils literal notranslate"><span class="pre">ST_AsText</span></code> to get the human readable form.
(line <strong>19</strong>).</p></li>
<li><p>Test from <a href="#id5"><span class="problematic" id="id6">|ch7_id_1|</span></a> to <a href="#id7"><span class="problematic" id="id8">|ch7_id_2|</span></a> on <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code>. (Last line)</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">DROP</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="n">regclass</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">);</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">edges_subset</span><span class="w"> </span><span class="n">REGCLASS</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="k">length</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span>
<span class="hll"><span class="linenos"> 6</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_readable</span><span class="w"> </span><span class="nb">TEXT</span>
</span><span class="linenos"> 7</span><span class="p">)</span>
<span class="linenos"> 8</span><span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="k">AS</span>
<span class="linenos"> 9</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">10</span><span class="k">WITH</span>
<span class="hll"><span class="linenos">11</span><span class="n">results</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span class="linenos">12</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">seconds</span>
<span class="linenos">13</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstra</span><span class="p">(</span>
<span class="linenos">14</span><span class="w">    </span><span class="s1">&#39;SELECT * FROM &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">15</span><span class="w">    </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">)</span>
<span class="linenos">16</span><span class="p">)</span>
<span class="linenos">17</span><span class="k">SELECT</span>
<span class="linenos">18</span><span class="w">  </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">length</span><span class="p">,</span>
<span class="hll"><span class="linenos">19</span><span class="w">  </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
</span><span class="linenos">20</span><span class="k">FROM</span><span class="w"> </span><span class="n">results</span>
<span class="linenos">21</span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vehicle_net</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="linenos">22</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span>
<span class="linenos">23</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">24</span><span class="k">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="p">;</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">route_readable</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="7e1cd87f-b5b7-4dad-962c-ebbd0c6d6120" name="7e1cd87f-b5b7-4dad-962c-ebbd0c6d6120" type="checkbox"><label class="sphinx_collapse__label" for="7e1cd87f-b5b7-4dad-962c-ebbd0c6d6120"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DROP</span> <span class="n">FUNCTION</span>
<span class="n">CREATE</span> <span class="n">FUNCTION</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-3-route-geometry-binary-format">
<h3><a class="toc-backref" href="#id23" role="doc-backlink"><span class="section-number">5.3.2. </span>Övning 3: Ruttgeometri (binärt format)</a><a class="headerlink" href="#exercise-3-route-geometry-binary-format" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/sql_route_geom.png"><img alt="Från |ch7_place_1| till |ch7_place_2|" src="../_images/sql_route_geom.png" style="width: 300pt;" />
</a>
<p class="rubric">Problem</p>
<p>Rutt från Emily Place Reserve till Auckland University of Technology</p>
<ul class="simple">
<li><p>Utöver den föregående övningen, skaffa</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">geom</span></code> i binärt format med namnet <code class="docutils literal notranslate"><span class="pre">route_geom</span></code></p></li>
</ul>
</li>
</ul>
<p class="rubric">Lösning</p>
<ul class="simple">
<li><p>The function returns <code class="docutils literal notranslate"><span class="pre">route_geom</span></code>. (line <strong>7</strong>)</p></li>
<li><p>The geometry <code class="docutils literal notranslate"><span class="pre">geom</span></code> of the segments (line <strong>21</strong>)</p></li>
<li><p>Test from <a href="#id9"><span class="problematic" id="id10">|ch7_id_1|</span></a> to <a href="#id11"><span class="problematic" id="id12">|ch7_id_2|</span></a> on <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code>. (Last line)</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">DROP</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="n">regclass</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">);</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">edges_subset</span><span class="w"> </span><span class="n">REGCLASS</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="k">length</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_readable</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="hll"><span class="linenos"> 7</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_geom</span><span class="w"> </span><span class="n">geometry</span>
</span><span class="linenos"> 8</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="k">AS</span>
<span class="linenos">10</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">11</span><span class="k">WITH</span>
<span class="linenos">12</span><span class="n">results</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="linenos">13</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">seconds</span>
<span class="linenos">14</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstra</span><span class="p">(</span>
<span class="linenos">15</span><span class="w">    </span><span class="s1">&#39;SELECT * FROM &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">16</span><span class="w">    </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">)</span>
<span class="linenos">17</span><span class="p">)</span>
<span class="linenos">18</span><span class="k">SELECT</span>
<span class="linenos">19</span><span class="w">  </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">length</span><span class="p">,</span>
<span class="linenos">20</span><span class="w">  </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">),</span>
<span class="hll"><span class="linenos">21</span><span class="w">  </span><span class="n">geom</span>
</span><span class="linenos">22</span><span class="k">FROM</span><span class="w"> </span><span class="n">results</span>
<span class="linenos">23</span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vehicle_net</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="linenos">24</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span>
<span class="linenos">25</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">26</span><span class="k">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="p">;</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">route_geom</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="5452ee1e-6b76-440b-befa-9519dcf1b08a" name="5452ee1e-6b76-440b-befa-9519dcf1b08a" type="checkbox"><label class="sphinx_collapse__label" for="5452ee1e-6b76-440b-befa-9519dcf1b08a"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DROP</span> <span class="n">FUNCTION</span>
<span class="n">CREATE</span> <span class="n">FUNCTION</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-4-route-geometry-directionality">
<h3><a class="toc-backref" href="#id24" role="doc-backlink"><span class="section-number">5.3.3. </span>Övning 4: Riktning för väggeometri</a><a class="headerlink" href="#exercise-4-route-geometry-directionality" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/sql_route_geom_detail.png"><img alt="Från |ch7_place_1| till |ch7_place_2|" src="../_images/sql_route_geom_detail.png" style="width: 300pt;" />
</a>
<p>Visuellt, när rutten visas med pilar, kan det konstateras att det finns pilar som inte stämmer överens med ruttens riktning.</p>
<p>För att riktningsverkan ska vara korrekt måste slutpunkten för en geometri motsvara startpunkten för nästa geometri</p>
<ul class="simple">
<li><p>Kontrollerar detaljerna i resultatet av <a class="reference internal" href="#exercise-2-route-geometry-human-readable">Övning 2: Ruttgeometri (läsbar för alla)</a></p></li>
</ul>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="366cba4c-1999-4151-b8a0-d19e813b3109" name="366cba4c-1999-4151-b8a0-d19e813b3109" type="checkbox"><label class="sphinx_collapse__label" for="366cba4c-1999-4151-b8a0-d19e813b3109"><i class="sphinx_collapse__icon"></i>Query: Rows where criteria is not met</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span>
<span class="n">results</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">route_geom</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">)</span>
<span class="p">),</span>
<span class="n">compare</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">lead</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">next_seq</span><span class="p">,</span>
<span class="w">  </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">ST_endPoint</span><span class="p">(</span><span class="n">route_geom</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_end</span><span class="p">,</span>
<span class="w">  </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">ST_startPoint</span><span class="p">(</span><span class="n">lead</span><span class="p">(</span><span class="n">route_geom</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">next_id_start</span>

<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">results</span>
<span class="w">  </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id_end</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">next_id_start</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p class="rubric">Problem</p>
<p>Rutt från Emily Place Reserve till Auckland University of Technology</p>
<ul class="simple">
<li><p>Fixera riktningen för geometrierna i föregående övning</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">geom</span></code> i mänskligt läsbar form benämnd <code class="docutils literal notranslate"><span class="pre">route_readable</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geom</span></code> i binärt format med namnet <code class="docutils literal notranslate"><span class="pre">route_geom</span></code></p></li>
<li><p>Båda kolumnerna måste ha geometrin fixerad för riktverkan.</p></li>
</ul>
</li>
</ul>
<p class="rubric">Lösning</p>
<p>För att få rätt riktning måste vissa geometrier vändas:</p>
<ul class="simple">
<li><p>Reversing a geometry will depend on the <code class="docutils literal notranslate"><span class="pre">node</span></code> column of the query to
Dijkstra.</p></li>
<li><p>En villkorlig <code class="docutils literal notranslate"><span class="pre">CASE</span></code>-sats som returnerar geometrin i läsbar form:</p>
<ul>
<li><p>Of the geometry when <code class="docutils literal notranslate"><span class="pre">node</span></code> is the <code class="docutils literal notranslate"><span class="pre">source</span></code> column.</p></li>
<li><p>Of the reversed geometry when <code class="docutils literal notranslate"><span class="pre">node</span></code> is not the <code class="docutils literal notranslate"><span class="pre">source</span></code> column.</p></li>
</ul>
</li>
<li><p>En villkorlig <code class="docutils literal notranslate"><span class="pre">CASE</span></code>-sats som returnerar:</p>
<ul>
<li><p>The geometry when <code class="docutils literal notranslate"><span class="pre">node</span></code> is the <code class="docutils literal notranslate"><span class="pre">source</span></code> column.</p></li>
<li><p>The reversed geometry when <code class="docutils literal notranslate"><span class="pre">node</span></code> is not the <code class="docutils literal notranslate"><span class="pre">source</span></code> column.</p></li>
</ul>
</li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">DROP</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="n">regclass</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">);</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">edges_subset</span><span class="w"> </span><span class="n">REGCLASS</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="k">length</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_readable</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_geom</span><span class="w"> </span><span class="n">geometry</span>
<span class="linenos"> 8</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="k">AS</span>
<span class="linenos">10</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">11</span><span class="k">WITH</span>
<span class="linenos">12</span><span class="n">results</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="linenos">13</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">seconds</span>
<span class="linenos">14</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstra</span><span class="p">(</span>
<span class="linenos">15</span><span class="w">    </span><span class="s1">&#39;SELECT * FROM &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">16</span><span class="w">    </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">)</span>
<span class="linenos">17</span><span class="p">)</span>
<span class="linenos">18</span><span class="k">SELECT</span>
<span class="linenos">19</span><span class="w">  </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">length</span><span class="p">,</span>
<span class="linenos">20</span><span class="w">  </span><span class="k">CASE</span>
<span class="linenos">21</span><span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
<span class="linenos">22</span><span class="w">      </span><span class="k">ELSE</span><span class="w"> </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">ST_Reverse</span><span class="p">(</span><span class="n">geom</span><span class="p">))</span>
<span class="linenos">23</span><span class="w">  </span><span class="k">END</span><span class="p">,</span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="w">  </span><span class="k">CASE</span>
<span class="linenos">26</span><span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">geom</span>
<span class="linenos">27</span><span class="w">      </span><span class="k">ELSE</span><span class="w"> </span><span class="n">ST_Reverse</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
<span class="linenos">28</span><span class="w">  </span><span class="k">END</span>
<span class="linenos">29</span><span class="k">FROM</span><span class="w"> </span><span class="n">results</span>
<span class="linenos">30</span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vehicle_net</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="linenos">31</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span>
<span class="linenos">32</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">33</span><span class="k">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="p">;</span>
<span class="linenos">34</span>
<span class="linenos">35</span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">route_readable</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="4d8b2926-1941-4ae8-a0ee-c627f9642b60" name="4d8b2926-1941-4ae8-a0ee-c627f9642b60" type="checkbox"><label class="sphinx_collapse__label" for="4d8b2926-1941-4ae8-a0ee-c627f9642b60"><i class="sphinx_collapse__icon"></i>results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DROP</span> <span class="n">FUNCTION</span>
<span class="n">CREATE</span> <span class="n">FUNCTION</span>
</pre></div>
</div>
</div>
</div>
<p>Inspecting the problematic rows, the directionality has been fixed.</p>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="3285a6ff-06c4-4810-a255-9fbc559e6c2a" name="3285a6ff-06c4-4810-a255-9fbc559e6c2a" type="checkbox"><label class="sphinx_collapse__label" for="3285a6ff-06c4-4810-a255-9fbc559e6c2a"><i class="sphinx_collapse__icon"></i>Query: Rows where criteria is not met</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span>
<span class="n">results</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">route_geom</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">)</span>
<span class="p">),</span>
<span class="n">compare</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">lead</span><span class="p">(</span><span class="n">route_geom</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">next_id</span><span class="p">,</span>
<span class="w">  </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">ST_endPoint</span><span class="p">(</span><span class="n">route_geom</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_end</span><span class="p">,</span>
<span class="w">  </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">ST_startPoint</span><span class="p">(</span><span class="n">lead</span><span class="p">(</span><span class="n">route_geom</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">next_id_start</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">results</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id_end</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">next_id_start</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</section>
<section id="exercise-5-using-the-geometry">
<h3><a class="toc-backref" href="#id25" role="doc-backlink"><span class="section-number">5.3.4. </span>Övning 5: Använda geometrin</a><a class="headerlink" href="#exercise-5-using-the-geometry" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/sql_azimuth_fixed.png"><img alt="Från |ch7_place_1| till |ch7_place_2| visa azimut" src="../_images/sql_azimuth_fixed.png" style="width: 300pt;" />
</a>
<p>Det finns många geometriska funktioner i PostGIS, workshopen har redan behandlat några av dem som <code class="docutils literal notranslate"><span class="pre">ST_AsText</span></code>, <code class="docutils literal notranslate"><span class="pre">ST_Reverse</span></code>, <code class="docutils literal notranslate"><span class="pre">ST_EndPoint</span></code>, etc. Denna övning kommer att använda ytterligare en funktion <code class="docutils literal notranslate"><span class="pre">ST_Azimuth</span></code>.</p>
<p class="rubric">Problem</p>
<p>Modifiera frågan från föregående övning</p>
<ul class="simple">
<li><p>Additionally obtain the azimuth in degrees of the corrected geometry.</p></li>
</ul>
<p class="rubric">Lösning</p>
<ul class="simple">
<li><p>The function returns <code class="docutils literal notranslate"><span class="pre">aximuth</span></code>. (line <strong>8</strong>)</p></li>
<li><p>The query from previous exercise is wrapped under additional subquery. (line
<strong>18</strong>)</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">azimuth</span></code> is processed in degrees. (line <strong>35</strong>).</p></li>
<li><p>Test from <a href="#id13"><span class="problematic" id="id14">|ch7_id_1|</span></a> to <a href="#id15"><span class="problematic" id="id16">|ch7_id_2|</span></a> on <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code>. (Last line)</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">DROP</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="n">regclass</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">);</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">edges_subset</span><span class="w"> </span><span class="n">REGCLASS</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="k">length</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_readable</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_geom</span><span class="w"> </span><span class="n">geometry</span><span class="p">,</span>
<span class="hll"><span class="linenos"> 8</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">azimuth</span><span class="w"> </span><span class="nb">FLOAT</span>
</span><span class="linenos"> 9</span><span class="p">)</span>
<span class="linenos">10</span><span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="k">AS</span>
<span class="linenos">11</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">12</span><span class="k">WITH</span>
<span class="linenos">13</span><span class="n">results</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="linenos">14</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">seconds</span>
<span class="linenos">15</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstra</span><span class="p">(</span>
<span class="linenos">16</span><span class="w">    </span><span class="s1">&#39;SELECT * FROM &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">17</span><span class="w">    </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">)),</span>
<span class="hll"><span class="linenos">18</span><span class="n">additional</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span class="linenos">19</span><span class="w">  </span><span class="k">SELECT</span>
<span class="linenos">20</span><span class="w">  </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">length</span><span class="p">,</span>
<span class="linenos">21</span><span class="w">  </span><span class="k">CASE</span>
<span class="linenos">22</span><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
<span class="linenos">23</span><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">ST_Reverse</span><span class="p">(</span><span class="n">geom</span><span class="p">))</span>
<span class="linenos">24</span><span class="w">  </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">readable</span><span class="p">,</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="w">  </span><span class="k">CASE</span>
<span class="linenos">27</span><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">geom</span>
<span class="linenos">28</span><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="n">ST_Reverse</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
<span class="linenos">29</span><span class="w">  </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">geom</span>
<span class="linenos">30</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">results</span>
<span class="linenos">31</span><span class="w">  </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vehicle_net</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="linenos">32</span><span class="w">  </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)</span>
<span class="linenos">33</span>
<span class="linenos">34</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="p">,</span>
<span class="hll"><span class="linenos">35</span><span class="w">  </span><span class="n">degrees</span><span class="p">(</span><span class="n">ST_azimuth</span><span class="p">(</span><span class="n">ST_StartPoint</span><span class="p">(</span><span class="n">geom</span><span class="p">),</span><span class="w"> </span><span class="n">ST_EndPoint</span><span class="p">(</span><span class="n">geom</span><span class="p">)))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">azimuth</span>
</span><span class="linenos">36</span><span class="k">FROM</span><span class="w"> </span><span class="n">additional</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span>
<span class="linenos">37</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">38</span><span class="k">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="p">;</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">azimuth</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="0d6d30b6-1545-4463-9a5e-ae190e6fd4e0" name="0d6d30b6-1545-4463-9a5e-ae190e6fd4e0" type="checkbox"><label class="sphinx_collapse__label" for="0d6d30b6-1545-4463-9a5e-ae190e6fd4e0"><i class="sphinx_collapse__icon"></i>results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DROP</span> <span class="n">FUNCTION</span>
<span class="n">CREATE</span> <span class="n">FUNCTION</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-6-using-the-function">
<h3><a class="toc-backref" href="#id26" role="doc-backlink"><span class="section-number">5.3.5. </span>Exercise 6: Using the function</a><a class="headerlink" href="#exercise-6-using-the-function" title="Link to this heading">¶</a></h3>
<p>Testa funktionen med en kombination av de intressanta platserna:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">10840</span></code> Auckland University of Technology</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">936</span></code> The Band Rotunda</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">21570</span></code> Four Points by Sheraton</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">10928</span></code> Sky tower</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">12777</span></code> Emily Place Reserve</p></li>
</ul>
<p>Using different networks:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">taxi_net</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">walk_net</span></code></p></li>
</ul>
<p>Namn på gatorna i rutten</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="08f8fbc4-db0c-493a-a39d-1a63d11db57e" name="08f8fbc4-db0c-493a-a39d-1a63d11db57e" type="checkbox"><label class="sphinx_collapse__label" for="08f8fbc4-db0c-493a-a39d-1a63d11db57e"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Totalt antal sekunder på varje gata</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;taxi_net&#39;</span><span class="p">,</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">)</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="611422ac-69df-429d-aaaa-e1a8de22f741" name="611422ac-69df-429d-aaaa-e1a8de22f741" type="checkbox"><label class="sphinx_collapse__label" for="611422ac-69df-429d-aaaa-e1a8de22f741"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Why it does not fully work with <code class="docutils literal notranslate"><span class="pre">walk_net</span></code>?</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;walk_net&#39;</span><span class="p">,</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="8d37b515-58a9-4a72-a4a4-c12cddf8e987" name="8d37b515-58a9-4a72-a4a4-c12cddf8e987" type="checkbox"><label class="sphinx_collapse__label" for="8d37b515-58a9-4a72-a4a4-c12cddf8e987"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2010-2025 pgRouting Developers.<br/>
      Senast uppdaterad okt. 07, 2025.<br/>
    </p>
  </div>
</footer>
  </body>
</html>