<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5. SQL function &#8212; Workshop - FOSS4G Auckland - Routing with pgRouting</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=5a695559" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css?v=226d88b4" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=fa3951f0" />
    <script src="../_static/documentation_options.js?v=fd79a9fb"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6. Routing using points" href="withPoints.html" />
    <link rel="prev" title="4. Vehicle Routing" href="vehicle.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="../index.html">
          Workshop FOSS4G Auckland</a>
        <span class="navbar-text pull-left"><b>3.1</b></span>

        <div class="nav-collapse">
          <ul class="nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://docs.pgrouting.org/latest/en/index.html">Documentation</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Chapters <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/osgeolive.html">2. OSGeoLive Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/overview.html">3. Software and Data Overview</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data.html">1. Prepare Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="graphs.html">2. Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="pedestrian.html">3. Pedestrian Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="vehicle.html">4. Vehicle Routing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. SQL function</a></li>
<li class="toctree-l1"><a class="reference internal" href="withPoints.html">6. Routing using points</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/data.html">1. Data for Sustainable Development Goals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/introduction.html">2. Achieving Sustainable Development Goals with pgRouting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/sdg3-health.html">3. Good Health and Well Being</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/sdg7-energy.html">4. Affordable and Clean Energy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/sdg11-cities.html">5. Sustainable Cities and Communities</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-9.html">1. Using Qgis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-10.html">2. WMS server with GeoServer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-11.html">3. OpenLayers Based Routing Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/chapter-12.html">4. Create a Network Topology</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/boost_dijkstra.html">1. Boost Dijkstra Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/hanoslav.html">2. Internet Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/wiki_example.html">3. Wikipedia Dijkstra Example</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-2.html">1. Appendix: Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-3.html">2. Appendix: osm2pgrouting Import Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-4.html">3. Video Tutorials for Workshop</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">5. SQL function</a><ul>
<li><a class="reference internal" href="#the-function-requirements">5.1. The function requirements</a></li>
<li><a class="reference internal" href="#additional-information-handling">5.2. Additional information handling</a><ul>
<li><a class="reference internal" href="#exercise-1-get-additional-information">5.2.1. Exercise 1: Get additional information</a></li>
</ul>
</li>
<li><a class="reference internal" href="#geometry-handling">5.3. Geometry handling</a><ul>
<li><a class="reference internal" href="#exercise-2-route-geometry-human-readable">5.3.1. Exercise 2: Route geometry (human readable)</a></li>
<li><a class="reference internal" href="#exercise-3-route-geometry-binary-format">5.3.2. Exercise 3: Route geometry (binary format)</a></li>
<li><a class="reference internal" href="#exercise-4-route-geometry-directionality">5.3.3. Exercise 4: Route geometry directionality</a></li>
<li><a class="reference internal" href="#exercise-5-using-the-geometry">5.3.4. Exercise 5: Using the geometry</a></li>
<li><a class="reference internal" href="#exercise-6-using-the-function">5.3.5. Exercise 6: Using the function</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="vehicle.html" title="Previous Chapter: 4. Vehicle Routing"><span class="icon-chevron-left visible-tablet"></span><span class="hidden-sm hidden-tablet">&laquo; 4. Vehicle Routing</span>
    </a>
  </li>
  <li>
    <a href="withPoints.html" title="Next Chapter: 6. Routing using points"><span class="icon-chevron-right visible-tablet"></span><span class="hidden-sm hidden-tablet">6. Routing us... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
      </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body span12 content" role="main">
      
  <section id="sql-function">
<h1><a class="toc-backref" href="#id17" role="doc-backlink"><span class="section-number">5. </span>SQL function</a><a class="headerlink" href="#sql-function" title="Link to this heading">¶</a></h1>
<a class="reference internal image-reference" href="../_images/sql_route_names.png"><img alt="../_images/sql_route_names.png" class="align-center" src="../_images/sql_route_names.png" style="width: 373.0px; height: 218.75px;" />
</a>
<nav class="contents" id="chapter-contents">
<p class="topic-title">Chapter Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sql-function" id="id17">SQL function</a></p>
<ul>
<li><p><a class="reference internal" href="#the-function-requirements" id="id18">The function requirements</a></p></li>
<li><p><a class="reference internal" href="#additional-information-handling" id="id19">Additional information handling</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-1-get-additional-information" id="id20">Exercise 1: Get additional information</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#geometry-handling" id="id21">Geometry handling</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-2-route-geometry-human-readable" id="id22">Exercise 2: Route geometry (human readable)</a></p></li>
<li><p><a class="reference internal" href="#exercise-3-route-geometry-binary-format" id="id23">Exercise 3: Route geometry (binary format)</a></p></li>
<li><p><a class="reference internal" href="#exercise-4-route-geometry-directionality" id="id24">Exercise 4: Route geometry directionality</a></p></li>
<li><p><a class="reference internal" href="#exercise-5-using-the-geometry" id="id25">Exercise 5: Using the geometry</a></p></li>
<li><p><a class="reference internal" href="#exercise-6-using-the-function" id="id26">Exercise 6: Using the function</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<p>pgRouting functions provide <cite>low level</cite> interface.</p>
<p>When developing for a <cite>higher level</cite> application,
the requirements need to be represented in the SQL queries.
As these SQL queries get more complex, it is desirable to store them in postgreSQL
stored procedures or functions.
Stored procedures or functions are an effective way to wrap application logic, in this case,
related to routing logic and requirements.</p>
<section id="the-function-requirements">
<h2><a class="toc-backref" href="#id18" role="doc-backlink"><span class="section-number">5.1. </span>The function requirements</a><a class="headerlink" href="#the-function-requirements" title="Link to this heading">¶</a></h2>
<p>The function will wrap <code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code>.</p>
<p>The function needs to work on any of the networks designed:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">taxi_net</span></code></p></li>
</ul>
<p>The function needs to return the following routing information:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">seq</span></code> - A unique identifier of the rows</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code> - The segment’s identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> - The segment’s name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">length</span></code> - The segment’s length</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seconds</span></code> - Number of seconds to traverse the segment</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">azimuth</span></code> - The azimuth of the segment</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">route_geom</span></code> - The routing geometry</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">route_readable</span></code> - The geometry in human readable form.</p></li>
</ul>
<p class="rubric">Design of the function</p>
<p>The function to be created <code class="docutils literal notranslate"><span class="pre">wrk_dijkstra</span></code> with the following input parameters and
output columns:</p>
<p class="rubric">Input parameters</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">edges_subset</span></code></p></td>
<td><p>REGCLASS</p></td>
<td><p>The table/view that is going to be used for processing</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">source</span></code></p></td>
<td><p>BIGINT</p></td>
<td><p>The  identifier of the <cite>departure</cite> location.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">target</span></code></p></td>
<td><p>BIGINT</p></td>
<td><p>The  identifier of the <cite>destination</cite> location.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">output columns</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">seq</span></code></p></td>
<td><p>INTEGER</p></td>
<td><p>A unique number for each result row.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>BIGINT</p></td>
<td><p>The edge identifier.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">name</span></code></p></td>
<td><p>TEXT</p></td>
<td><p>The name of the segment.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">seconds</span></code></p></td>
<td><p>FLOAT</p></td>
<td><p>The number of seconds it takes to traverse the segment.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">length</span></code></p></td>
<td><p>FLOAT</p></td>
<td><p>The length in meters of the segment.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">azimuth</span></code></p></td>
<td><p>FLOAT</p></td>
<td><p>The azimuth of the segment.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">route_readable</span></code></p></td>
<td><p>TEXT</p></td>
<td><p>The geometry in human readable form.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">route_geom</span></code></p></td>
<td><p>geometry</p></td>
<td><p>The geometry of the segment in the correct direction.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="additional-information-handling">
<h2><a class="toc-backref" href="#id19" role="doc-backlink"><span class="section-number">5.2. </span>Additional information handling</a><a class="headerlink" href="#additional-information-handling" title="Link to this heading">¶</a></h2>
<p>When the application needs additional information, like the name of the street,
<code class="docutils literal notranslate"><span class="pre">JOIN</span></code> the results with other tables.</p>
<section id="exercise-1-get-additional-information">
<h3><a class="toc-backref" href="#id20" role="doc-backlink"><span class="section-number">5.2.1. </span>Exercise 1: Get additional information</a><a class="headerlink" href="#exercise-1-get-additional-information" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/sql_route_names.png"><img alt="Route showing names" src="../_images/sql_route_names.png" style="width: 300pt;" />
</a>
<p class="rubric">Problem</p>
<ul class="simple">
<li><p>From Emily Place Reserve to Auckland University of Technology</p></li>
<li><p>Get the following information:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">seq</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seconds</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">length</span></code></p></li>
</ul>
</li>
</ul>
<p class="rubric">Solution</p>
<ul class="simple">
<li><p>The function returns the columns asked. (line <strong>4</strong>)</p></li>
<li><p>Rename <code class="docutils literal notranslate"><span class="pre">pgr_dijkstra</span></code> results to application requirements names. (line
<strong>12</strong>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LEFT</span> <span class="pre">JOIN</span></code> the results with <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code> to get the additional
information. (line <strong>17</strong>)</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">LEFT</span></code> to include the row with <code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">=</span> <span class="pre">-1</span></code> because it does not exist on
<code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code></p></li>
</ul>
</li>
<li><p>Test from <a href="#id1"><span class="problematic" id="id2">|ch7_id_1|</span></a> to <a href="#id3"><span class="problematic" id="id4">|ch7_id_2|</span></a> on <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code>. (Last line)</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">-- DROP FUNCTION wrk_dijkstra(regclass, bigint, bigint);</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span>
<span class="hll"><span class="linenos"> 4</span><span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">edges_subset</span><span class="w"> </span><span class="n">REGCLASS</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
</span><span class="linenos"> 5</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="k">length</span><span class="w"> </span><span class="nb">FLOAT</span>
<span class="linenos"> 6</span><span class="p">)</span>
<span class="linenos"> 7</span><span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="k">AS</span>
<span class="linenos"> 8</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos"> 9</span><span class="k">SELECT</span>
<span class="linenos">10</span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">length</span>
<span class="linenos">11</span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="hll"><span class="linenos">12</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">seconds</span>
</span><span class="linenos">13</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstra</span><span class="p">(</span>
<span class="linenos">14</span><span class="w">    </span><span class="s1">&#39;SELECT * FROM &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">15</span><span class="w">    </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">)</span>
<span class="linenos">16</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">results</span>
<span class="hll"><span class="linenos">17</span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vehicle_net</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
</span><span class="linenos">18</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span>
<span class="linenos">19</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">20</span><span class="k">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="p">;</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="c613f26d-4809-4418-a7fe-b60a38761f17" name="c613f26d-4809-4418-a7fe-b60a38761f17" type="checkbox"><label class="sphinx_collapse__label" for="c613f26d-4809-4418-a7fe-b60a38761f17"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">FUNCTION</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="geometry-handling">
<h2><a class="toc-backref" href="#id21" role="doc-backlink"><span class="section-number">5.3. </span>Geometry handling</a><a class="headerlink" href="#geometry-handling" title="Link to this heading">¶</a></h2>
<p>From pgRouting point of view, the geometry is part of the additional
information, needed on the results for an application. Therefore <code class="docutils literal notranslate"><span class="pre">JOIN</span></code> the
results with other tables that contain the geometry and for further processing
with PostGIS functions.</p>
<section id="exercise-2-route-geometry-human-readable">
<h3><a class="toc-backref" href="#id22" role="doc-backlink"><span class="section-number">5.3.1. </span>Exercise 2: Route geometry (human readable)</a><a class="headerlink" href="#exercise-2-route-geometry-human-readable" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/sql_route_readable.png"><img alt="From |ch7_place_1| to |ch7_place_2|" src="../_images/sql_route_readable.png" style="width: 300pt;" />
</a>
<p class="rubric">Problem</p>
<p>Route from the Emily Place Reserve to Auckland University of Technology</p>
<ul class="simple">
<li><p>Additionally to the previous exercise, get the</p>
<ul>
<li><p>geometry <code class="docutils literal notranslate"><span class="pre">geom</span></code> in human readable form named as <code class="docutils literal notranslate"><span class="pre">route_readable</span></code></p></li>
</ul>
</li>
</ul>
<p class="rubric">Solution</p>
<ul class="simple">
<li><p>The function returns <code class="docutils literal notranslate"><span class="pre">route_readable</span></code>. (line <strong>6</strong>)</p></li>
<li><p>The routing query named <code class="docutils literal notranslate"><span class="pre">results</span></code> in a WITH clause. (line <strong>11</strong>)</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">geom</span></code> processed with <code class="docutils literal notranslate"><span class="pre">ST_AsText</span></code> to get the human readable form.
(line <strong>19</strong>).</p></li>
<li><p>Test from <a href="#id5"><span class="problematic" id="id6">|ch7_id_1|</span></a> to <a href="#id7"><span class="problematic" id="id8">|ch7_id_2|</span></a> on <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code>. (Last line)</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">DROP</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="n">regclass</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">);</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">edges_subset</span><span class="w"> </span><span class="n">REGCLASS</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="k">length</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span>
<span class="hll"><span class="linenos"> 6</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_readable</span><span class="w"> </span><span class="nb">TEXT</span>
</span><span class="linenos"> 7</span><span class="p">)</span>
<span class="linenos"> 8</span><span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="k">AS</span>
<span class="linenos"> 9</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">10</span><span class="k">WITH</span>
<span class="hll"><span class="linenos">11</span><span class="n">results</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span class="linenos">12</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">seconds</span>
<span class="linenos">13</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstra</span><span class="p">(</span>
<span class="linenos">14</span><span class="w">    </span><span class="s1">&#39;SELECT * FROM &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">15</span><span class="w">    </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">)</span>
<span class="linenos">16</span><span class="p">)</span>
<span class="linenos">17</span><span class="k">SELECT</span>
<span class="linenos">18</span><span class="w">  </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">length</span><span class="p">,</span>
<span class="hll"><span class="linenos">19</span><span class="w">  </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
</span><span class="linenos">20</span><span class="k">FROM</span><span class="w"> </span><span class="n">results</span>
<span class="linenos">21</span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vehicle_net</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="linenos">22</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span>
<span class="linenos">23</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">24</span><span class="k">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="p">;</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">route_readable</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="8898f121-f6da-4b53-a440-61a977d515a0" name="8898f121-f6da-4b53-a440-61a977d515a0" type="checkbox"><label class="sphinx_collapse__label" for="8898f121-f6da-4b53-a440-61a977d515a0"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DROP</span> <span class="n">FUNCTION</span>
<span class="n">CREATE</span> <span class="n">FUNCTION</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-3-route-geometry-binary-format">
<h3><a class="toc-backref" href="#id23" role="doc-backlink"><span class="section-number">5.3.2. </span>Exercise 3: Route geometry (binary format)</a><a class="headerlink" href="#exercise-3-route-geometry-binary-format" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/sql_route_geom.png"><img alt="From |ch7_place_1| to |ch7_place_2|" src="../_images/sql_route_geom.png" style="width: 300pt;" />
</a>
<p class="rubric">Problem</p>
<p>Route from the Emily Place Reserve to Auckland University of Technology</p>
<ul class="simple">
<li><p>Additionally to the previous exercise, get the</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">geom</span></code> in binary format with the name <code class="docutils literal notranslate"><span class="pre">route_geom</span></code></p></li>
</ul>
</li>
</ul>
<p class="rubric">Solution</p>
<ul class="simple">
<li><p>The function returns <code class="docutils literal notranslate"><span class="pre">route_geom</span></code>. (line <strong>7</strong>)</p></li>
<li><p>The geometry <code class="docutils literal notranslate"><span class="pre">geom</span></code> of the segments (line <strong>21</strong>)</p></li>
<li><p>Test from <a href="#id9"><span class="problematic" id="id10">|ch7_id_1|</span></a> to <a href="#id11"><span class="problematic" id="id12">|ch7_id_2|</span></a> on <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code>. (Last line)</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">DROP</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="n">regclass</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">);</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">edges_subset</span><span class="w"> </span><span class="n">REGCLASS</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="k">length</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_readable</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="hll"><span class="linenos"> 7</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_geom</span><span class="w"> </span><span class="n">geometry</span>
</span><span class="linenos"> 8</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="k">AS</span>
<span class="linenos">10</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">11</span><span class="k">WITH</span>
<span class="linenos">12</span><span class="n">results</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="linenos">13</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">seconds</span>
<span class="linenos">14</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstra</span><span class="p">(</span>
<span class="linenos">15</span><span class="w">    </span><span class="s1">&#39;SELECT * FROM &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">16</span><span class="w">    </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">)</span>
<span class="linenos">17</span><span class="p">)</span>
<span class="linenos">18</span><span class="k">SELECT</span>
<span class="linenos">19</span><span class="w">  </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">length</span><span class="p">,</span>
<span class="linenos">20</span><span class="w">  </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">),</span>
<span class="hll"><span class="linenos">21</span><span class="w">  </span><span class="n">geom</span>
</span><span class="linenos">22</span><span class="k">FROM</span><span class="w"> </span><span class="n">results</span>
<span class="linenos">23</span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vehicle_net</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="linenos">24</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span>
<span class="linenos">25</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">26</span><span class="k">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="p">;</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">route_geom</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="e8153f8f-0dde-45a1-964a-10a55a4d3462" name="e8153f8f-0dde-45a1-964a-10a55a4d3462" type="checkbox"><label class="sphinx_collapse__label" for="e8153f8f-0dde-45a1-964a-10a55a4d3462"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DROP</span> <span class="n">FUNCTION</span>
<span class="n">CREATE</span> <span class="n">FUNCTION</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-4-route-geometry-directionality">
<h3><a class="toc-backref" href="#id24" role="doc-backlink"><span class="section-number">5.3.3. </span>Exercise 4: Route geometry directionality</a><a class="headerlink" href="#exercise-4-route-geometry-directionality" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/sql_route_geom_detail.png"><img alt="From |ch7_place_1| to |ch7_place_2|" src="../_images/sql_route_geom_detail.png" style="width: 300pt;" />
</a>
<p>Visually, with the route displayed with arrows, it can be found that there are
arrows that do not match the directionality of the route.</p>
<p>To have correct directionality, the ending point of a geometry must match the
starting point of the next geometry</p>
<ul class="simple">
<li><p>Inspecting the detail of the results of <a class="reference internal" href="#exercise-2-route-geometry-human-readable">Exercise 2: Route geometry (human
readable)</a></p></li>
</ul>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="88fc8f9b-2ec2-42cf-ab37-38345d600180" name="88fc8f9b-2ec2-42cf-ab37-38345d600180" type="checkbox"><label class="sphinx_collapse__label" for="88fc8f9b-2ec2-42cf-ab37-38345d600180"><i class="sphinx_collapse__icon"></i>Query: Rows where criteria is not met</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span>
<span class="n">results</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">route_geom</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">)</span>
<span class="p">),</span>
<span class="n">compare</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">lead</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">next_seq</span><span class="p">,</span>
<span class="w">  </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">ST_endPoint</span><span class="p">(</span><span class="n">route_geom</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_end</span><span class="p">,</span>
<span class="w">  </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">ST_startPoint</span><span class="p">(</span><span class="n">lead</span><span class="p">(</span><span class="n">route_geom</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">next_id_start</span>

<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">results</span>
<span class="w">  </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id_end</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">next_id_start</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p class="rubric">Problem</p>
<p>Route from the Emily Place Reserve to Auckland University of Technology</p>
<ul class="simple">
<li><p>Fix the directionality of the geometries of the previous exercise</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">geom</span></code> in human readable form named as <code class="docutils literal notranslate"><span class="pre">route_readable</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geom</span></code> in binary format with the name <code class="docutils literal notranslate"><span class="pre">route_geom</span></code></p></li>
<li><p>Both columns must have the geometry fixed for directionality.</p></li>
</ul>
</li>
</ul>
<p class="rubric">Solution</p>
<p>To get the correct direction some geometries need to be reversed:</p>
<ul class="simple">
<li><p>Reversing a geometry will depend on the <code class="docutils literal notranslate"><span class="pre">node</span></code> column of the query to
Dijkstra.</p></li>
<li><p>A conditional <code class="docutils literal notranslate"><span class="pre">CASE</span></code> statement that returns the geometry in human readable
form:</p>
<ul>
<li><p>Of the geometry when <code class="docutils literal notranslate"><span class="pre">node</span></code> is the <code class="docutils literal notranslate"><span class="pre">source</span></code> column.</p></li>
<li><p>Of the reversed geometry when <code class="docutils literal notranslate"><span class="pre">node</span></code> is not the <code class="docutils literal notranslate"><span class="pre">source</span></code> column.</p></li>
</ul>
</li>
<li><p>A conditional <code class="docutils literal notranslate"><span class="pre">CASE</span></code> statement that returns:</p>
<ul>
<li><p>The geometry when <code class="docutils literal notranslate"><span class="pre">node</span></code> is the <code class="docutils literal notranslate"><span class="pre">source</span></code> column.</p></li>
<li><p>The reversed geometry when <code class="docutils literal notranslate"><span class="pre">node</span></code> is not the <code class="docutils literal notranslate"><span class="pre">source</span></code> column.</p></li>
</ul>
</li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">DROP</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="n">regclass</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">);</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">edges_subset</span><span class="w"> </span><span class="n">REGCLASS</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="k">length</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_readable</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_geom</span><span class="w"> </span><span class="n">geometry</span>
<span class="linenos"> 8</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="k">AS</span>
<span class="linenos">10</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">11</span><span class="k">WITH</span>
<span class="linenos">12</span><span class="n">results</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="linenos">13</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">seconds</span>
<span class="linenos">14</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstra</span><span class="p">(</span>
<span class="linenos">15</span><span class="w">    </span><span class="s1">&#39;SELECT * FROM &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">16</span><span class="w">    </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">)</span>
<span class="linenos">17</span><span class="p">)</span>
<span class="linenos">18</span><span class="k">SELECT</span>
<span class="linenos">19</span><span class="w">  </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">length</span><span class="p">,</span>
<span class="linenos">20</span><span class="w">  </span><span class="k">CASE</span>
<span class="linenos">21</span><span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
<span class="linenos">22</span><span class="w">      </span><span class="k">ELSE</span><span class="w"> </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">ST_Reverse</span><span class="p">(</span><span class="n">geom</span><span class="p">))</span>
<span class="linenos">23</span><span class="w">  </span><span class="k">END</span><span class="p">,</span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="w">  </span><span class="k">CASE</span>
<span class="linenos">26</span><span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">geom</span>
<span class="linenos">27</span><span class="w">      </span><span class="k">ELSE</span><span class="w"> </span><span class="n">ST_Reverse</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
<span class="linenos">28</span><span class="w">  </span><span class="k">END</span>
<span class="linenos">29</span><span class="k">FROM</span><span class="w"> </span><span class="n">results</span>
<span class="linenos">30</span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vehicle_net</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="linenos">31</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span>
<span class="linenos">32</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">33</span><span class="k">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="p">;</span>
<span class="linenos">34</span>
<span class="linenos">35</span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">route_readable</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="9eb89478-06be-42d4-8d68-7532ac6a6e88" name="9eb89478-06be-42d4-8d68-7532ac6a6e88" type="checkbox"><label class="sphinx_collapse__label" for="9eb89478-06be-42d4-8d68-7532ac6a6e88"><i class="sphinx_collapse__icon"></i>results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DROP</span> <span class="n">FUNCTION</span>
<span class="n">CREATE</span> <span class="n">FUNCTION</span>
</pre></div>
</div>
</div>
</div>
<p>Inspecting the problematic rows, the directionality has been fixed.</p>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="d9f5264f-c695-4a73-8254-007fff5214c1" name="d9f5264f-c695-4a73-8254-007fff5214c1" type="checkbox"><label class="sphinx_collapse__label" for="d9f5264f-c695-4a73-8254-007fff5214c1"><i class="sphinx_collapse__icon"></i>Query: Rows where criteria is not met</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span>
<span class="n">results</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">route_geom</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">)</span>
<span class="p">),</span>
<span class="n">compare</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">lead</span><span class="p">(</span><span class="n">route_geom</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">next_id</span><span class="p">,</span>
<span class="w">  </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">ST_endPoint</span><span class="p">(</span><span class="n">route_geom</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_end</span><span class="p">,</span>
<span class="w">  </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">ST_startPoint</span><span class="p">(</span><span class="n">lead</span><span class="p">(</span><span class="n">route_geom</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">next_id_start</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">results</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id_end</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">next_id_start</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</section>
<section id="exercise-5-using-the-geometry">
<h3><a class="toc-backref" href="#id25" role="doc-backlink"><span class="section-number">5.3.4. </span>Exercise 5: Using the geometry</a><a class="headerlink" href="#exercise-5-using-the-geometry" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/sql_azimuth_fixed.png"><img alt="From |ch7_place_1| to the |ch7_place_2| show azimuth" src="../_images/sql_azimuth_fixed.png" style="width: 300pt;" />
</a>
<p>There are many geometry functions in PostGIS, the workshop already covered some of them like
<code class="docutils literal notranslate"><span class="pre">ST_AsText</span></code>, <code class="docutils literal notranslate"><span class="pre">ST_Reverse</span></code>, <code class="docutils literal notranslate"><span class="pre">ST_EndPoint</span></code>, etc.
This exercise will make use an additional function <code class="docutils literal notranslate"><span class="pre">ST_Azimuth</span></code>.</p>
<p class="rubric">Problem</p>
<p>Modify the query from the previous exercise</p>
<ul class="simple">
<li><p>Additionally obtain the azimuth in degrees of the corrected geometry.</p></li>
</ul>
<p class="rubric">Solution</p>
<ul class="simple">
<li><p>The function returns <code class="docutils literal notranslate"><span class="pre">aximuth</span></code>. (line <strong>8</strong>)</p></li>
<li><p>The query from previous exercise is wrapped under additional subquery. (line
<strong>18</strong>)</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">azimuth</span></code> is processed in degrees. (line <strong>35</strong>).</p></li>
<li><p>Test from <a href="#id13"><span class="problematic" id="id14">|ch7_id_1|</span></a> to <a href="#id15"><span class="problematic" id="id16">|ch7_id_2|</span></a> on <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code>. (Last line)</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">DROP</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="n">regclass</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">,</span><span class="w"> </span><span class="nb">bigint</span><span class="p">);</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">edges_subset</span><span class="w"> </span><span class="n">REGCLASS</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="k">length</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_readable</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">route_geom</span><span class="w"> </span><span class="n">geometry</span><span class="p">,</span>
<span class="hll"><span class="linenos"> 8</span><span class="w">  </span><span class="k">OUT</span><span class="w"> </span><span class="n">azimuth</span><span class="w"> </span><span class="nb">FLOAT</span>
</span><span class="linenos"> 9</span><span class="p">)</span>
<span class="linenos">10</span><span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="k">AS</span>
<span class="linenos">11</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">12</span><span class="k">WITH</span>
<span class="linenos">13</span><span class="n">results</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="linenos">14</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">seconds</span>
<span class="linenos">15</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstra</span><span class="p">(</span>
<span class="linenos">16</span><span class="w">    </span><span class="s1">&#39;SELECT * FROM &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">17</span><span class="w">    </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">)),</span>
<span class="hll"><span class="linenos">18</span><span class="n">additional</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span class="linenos">19</span><span class="w">  </span><span class="k">SELECT</span>
<span class="linenos">20</span><span class="w">  </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">length</span><span class="p">,</span>
<span class="linenos">21</span><span class="w">  </span><span class="k">CASE</span>
<span class="linenos">22</span><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
<span class="linenos">23</span><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">ST_Reverse</span><span class="p">(</span><span class="n">geom</span><span class="p">))</span>
<span class="linenos">24</span><span class="w">  </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">readable</span><span class="p">,</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="w">  </span><span class="k">CASE</span>
<span class="linenos">27</span><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">geom</span>
<span class="linenos">28</span><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="n">ST_Reverse</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
<span class="linenos">29</span><span class="w">  </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">geom</span>
<span class="linenos">30</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">results</span>
<span class="linenos">31</span><span class="w">  </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">vehicle_net</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="linenos">32</span><span class="w">  </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">)</span>
<span class="linenos">33</span>
<span class="linenos">34</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="p">,</span>
<span class="hll"><span class="linenos">35</span><span class="w">  </span><span class="n">degrees</span><span class="p">(</span><span class="n">ST_azimuth</span><span class="p">(</span><span class="n">ST_StartPoint</span><span class="p">(</span><span class="n">geom</span><span class="p">),</span><span class="w"> </span><span class="n">ST_EndPoint</span><span class="p">(</span><span class="n">geom</span><span class="p">)))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">azimuth</span>
</span><span class="linenos">36</span><span class="k">FROM</span><span class="w"> </span><span class="n">additional</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span>
<span class="linenos">37</span><span class="err">$</span><span class="n">BODY$</span>
<span class="linenos">38</span><span class="k">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="p">;</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="k">SELECT</span><span class="w"> </span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">azimuth</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="a6783ba4-8b30-47d1-ba43-9e1e52cb456c" name="a6783ba4-8b30-47d1-ba43-9e1e52cb456c" type="checkbox"><label class="sphinx_collapse__label" for="a6783ba4-8b30-47d1-ba43-9e1e52cb456c"><i class="sphinx_collapse__icon"></i>results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DROP</span> <span class="n">FUNCTION</span>
<span class="n">CREATE</span> <span class="n">FUNCTION</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-6-using-the-function">
<h3><a class="toc-backref" href="#id26" role="doc-backlink"><span class="section-number">5.3.5. </span>Exercise 6: Using the function</a><a class="headerlink" href="#exercise-6-using-the-function" title="Link to this heading">¶</a></h3>
<p>Try the function with a combination of the interesting places:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">10840</span></code> Auckland University of Technology</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">936</span></code> The Band Rotunda</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">21570</span></code> Four Points by Sheraton</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">10928</span></code> Sky tower</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">12777</span></code> Emily Place Reserve</p></li>
</ul>
<p>Using different networks:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">taxi_net</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">walk_net</span></code></p></li>
</ul>
<p>Names of the streets in the route</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;vehicle_net&#39;</span><span class="p">,</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="e400cf34-f5b6-43c2-97b0-658b369b255b" name="e400cf34-f5b6-43c2-97b0-658b369b255b" type="checkbox"><label class="sphinx_collapse__label" for="e400cf34-f5b6-43c2-97b0-658b369b255b"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Total seconds spent in each street</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;taxi_net&#39;</span><span class="p">,</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">)</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="f9240543-be62-4a68-9ac8-d420c1998b71" name="f9240543-be62-4a68-9ac8-d420c1998b71" type="checkbox"><label class="sphinx_collapse__label" for="f9240543-be62-4a68-9ac8-d420c1998b71"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Why it does not fully work with <code class="docutils literal notranslate"><span class="pre">walk_net</span></code>?</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">wrk_dijkstra</span><span class="p">(</span><span class="s1">&#39;walk_net&#39;</span><span class="p">,</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="3cc14704-f1f3-4744-b097-6ba658213512" name="3cc14704-f1f3-4744-b097-6ba658213512" type="checkbox"><label class="sphinx_collapse__label" for="3cc14704-f1f3-4744-b097-6ba658213512"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2010-2025 pgRouting Developers.<br/>
      Last updated on Oct 07, 2025.<br/>
    </p>
  </div>
</footer>
  </body>
</html>